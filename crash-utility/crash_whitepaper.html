<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<!-- HISTORY:
  2008-01-24 MARK YARBOROUGH - Brute force single page
   	-Started with Dave Anderson's updated 2008 version
    -Concatenated main pages into single file
    -Converted table of content links to internal anchors
    -NOTE: some links (like help files) are still relative
       to Dave's people page and will therefore fail if this
       page is not viewed in a similar directory tree....
-->
    



<html>
<head>
<!-- MAIN BODY TABLE is nested for scalability -->
                        <a name="toc"><h1>White Paper: Crash Utility</h1></a>
                        <p>by David Anderson</p>
                        <p>Copyright &copy; 2003, 2008, 2022 by Red Hat, Inc.<br />
                           Copyright &copy; 2022 by NEC Corporation</p>

			<p>
Permission is granted to copy, distribute and/or modify this document under the terms of<br>
the GNU Free Documentation License, Version 1.2 or any later version published by the<br>
Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.<br>
A copy of the license is included in the section entitled "GNU Free Documentation License".			
			</p>
                        <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                        <td><img src="/img/pixel.gif" width="1" height="10" border="0" alt="" /></td>
                                </tr>

                                <tr>
                                        <td bgcolor="#666666"><img src="/img/pixel.gif" width="1" height="1" border="0" alt=""></td>
                                </tr>
                                <tr>
                                        <td><img src="/img/pixel.gif" width="1" height="10" border="0" alt="" /></td>
                                </tr>
                        </table>
                        <h3>Content</h3>

                        <ol>
                                <li><a href="#WHY_CRASH" class="bluelinkbold">Why Crash?</a></li>
                                <li><a href="#PREREQUISITES" class="bluelinkbold">Prerequisites</a></li>
                                <li><a href="#BUILD_PROCEDURE" class="bluelinkbold">Build Procedure</a></li>
                                <li><a href="#INVOCATION" class="bluelinkbold">Invocation</a></li>
                                <li><a href="#COMMAND_LINE" class="bluelinkbold">Command Input</a></li>

                                <li><a href="#COMMAND_OUTPUT" class="bluelinkbold">Command Output</a></li>
                                <li><a href="#CRASH_CONTEXT" class="bluelinkbold">Crash Context</a></li>
                                <li><a href="#HELP" class="bluelinkbold">Builtin Help</a></li>
                                <li><a href="#COMMAND_SET" class="bluelinkbold">The Command Set</a></li>
                                <li><a href="#EXAMPLES" class="bluelinkbold">Crash Usage: A Case Study</a></li>
                                <li><a href="#EXTENSIONS" class="bluelinkbold">Command Extensions</a></li>

                                <li><a href="#GFDL" class="bluelinkbold">GNU Free Documentation License</a></li>
                        </ol>
                        <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                        <td><img src="/img/pixel.gif" width="1" height="10" border="0" alt="" /></td>
                                </tr>
                                <tr>
                                        <td bgcolor="#666666"><img src="/img/pixel.gif" width="1" height="1" border="0" alt=""></td>

                                </tr>
                                <tr>
                                        <td><img src="/img/pixel.gif" width="1" height="10" border="0" alt="" /></td>
                                </tr>
                        </table>
<a name="SUPPORTED"></a>
                        <h3>Abstract</h3>
<p>
The <tt>crash</tt> analysis utility is loosely based on the SVR4 UNIX <tt>crash</tt> command,
but has been significantly enhanced by completely merging it with the GNU <tt>gdb</tt> debugger.  The marriage of the two effectively
combines the kernel-specific nature of the traditional UNIX <tt>crash</tt> utility with the source code
level debugging capabilities of <tt>gdb</tt>. The utility can be used to investigate:

<ul>
<li>Live Linux systems</a></li>
<li>Linux kernel core dumps created by the Kdump facility</li>
<li>Compressed Linux kernel core dumps created by the makedumpfile command (from kdump dumpfiles)</li>
<li>Linux kernel core dumps created from by the Red Hat Netdump facility</li>
<li>Linux kernel core dumps created from by the Red Hat Diskdump facility</li>
<li>Compressed Linux kernel core dumps created by the Red Hat Diskdump facility</li>
<li>Xen host Linux kernel core dumps created by the Kdump facility</li>
<li>Xen guest Linux kernel core dumps created by the original xendump facility</li>

<li>Xen guest Linux kernel core dumps created by the ELF-format xendump facility</li>
<li>Xen hypervisor core dumps created by the Kdump facility</li>
<li>KVM guest Linux kernel core dumps created by the <tt>virsh dump</tt> facility</li>
<li>s390 Linux kernel core dumps created by the IBM standalone core dump facility.
<li>s390x Linux kernel core dumps created by the IBM standalone core dump facility.
<li>Linux kernel core dumps created by the LKCD (Linux Kernel Crash Dumps) Sourceforge project</li>
<li>Linux kernel core dumps created by the Mcore patch offered by Mission Critical Linux</li>
</ul>
The current set of commands consist of common kernel core analysis tools such as
kernel stack back traces of all processes, source code disassembly, formatted
kernel structure and variable displays, virtual memory data, dumps of linked-lists, etc.,
along with several commands that delve deeper into specific kernel subsystems.
Relevant <tt>gdb</tt> commands may also be entered, which in turn are passed on to the
<tt>gdb</tt> module for execution.

<p>
The <tt>crash</tt> utility is designed to be independent of Linux version dependencies.
When new kernel source code impacts the correct functionality of <tt>crash</tt> and its
command set, the utility will be updated to recognize new kernel code changes  
while maintaining backwards compatibility with earlier releases.
The most current version of the <tt>crash</tt> utility may be found
here: <a href="https://crash-utility.github.io/">https://crash-utility.github.io/</a>


<p><br>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="WHY_CRASH"></a> <hr> <p>


<h3>Why Crash?</h3>
<p>
The Linux operating system originally lacked a built-in, traditional UNIX-like kernel crash dump facility.
This was initially addressed by the Mission Critical Linux Mcore kernel patch and
the LKCD (Linux Kernel Crash Dump) kernel patch from SGI in 1999, and later
by the Red Hat Netdump facility in 2002, and the Red hat Diskdump facility in 2004.
The upstream Linux community finally settled
upon the adoption of the Kdump crash dump facility in 2006.  
<p>However, the creation of a kernel crash dump
file is only half of the picture; a utility is required to be
able to recognize the dumpfile format in order to read it, and to offer a useful set of commands
to make sense of it.
</p>
<p>Furthermore, to examine the contents of a live system's kernel internals 
from user space, the only readily available 
option has been to use <tt>gdb</tt> on <tt>/proc/kcore</tt>.  
While <tt>gdb</tt> is an incredibly powerful tool, it is designed to
debug user programs, and is not at all "kernel-aware".
Consequently, using <tt>gdb</tt>

alone has limited usefulness when looking at kernel memory,
essentially constrained to the printing
of kernel data structures <b><i>if</i></b> the <tt>vmlinux</tt> file was built with
the <tt>-g</tt> C flag, the disassembly of kernel text, and raw
data dumps.  Furthermore, distributions such as Red Hat Enterprise Linux
have limited the access to <tt>/proc/kcore</tt>, making it unusable
as a kernel memory source.
</p>
<p>As far as kernel crash dump files are concerned, 
the Red Hat Netdump and uncompressed Diskdump facilities, and the Kdump facility create 
dump files that <b><i>are</i></b> readable by <tt>gdb</tt>, but aside from giving it the 
capability of displaying the panicking task's stack trace, it has
the same constraints as when reading <tt>/proc/kcore</tt>.   
However, <tt>gdb</tt> cannot read LKCD, Mcore, Xen or s390/s390x dump files.


</p>
<p>
That being the state of things, the <tt>crash</tt> utility was developed as a 
convenient means to cover all bases, i.e., all listed 
<a href="#SUPPORTED" class="bluelinkbold">dumpfile formats</a>
as well as live systems.  Moreover, it is also designed to be
easily enhanced to suit the specific needs of the kernel developers or analysts
using it; the builtin command set can easily be extended or enhanced, and
external command modules may be written and dynamically attached.
</p>


<p><br>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="PREREQUISITES"></a> <hr> <p>





<p>
<h3>Prerequisites</h3>
<p>The <tt>crash</tt> utility has the following prerequisites:</p>
<blockquote>
<dl>
<dt><b>kernel object file:</b></dt>
<dd><br>
A <tt>vmlinux</tt> kernel object file, often referred to as the <i>namelist</i> in this document, which 

<b><i>must</i></b> have been built with
the <tt>-g</tt> C flag so that it will contain the debug data
required for symbolic debugging.  
<p>
In RHEL3 installations, the <tt>vmlinux</tt> file associated with the running kernel is
split into two files, a stripped version found in the <tt>/boot</tt> directory; which has
have the operating system release string appended to it, for example,
<tt>vmlinux-2.4.21-4.ELsmp</tt>.  The stripped file in <tt>/boot</tt> contains a link
to its associated debuginfo file, which is located in the <tt>/usr/lib/debug/boot</tt>

directory.
<p>In RHEL4, RHEL5 and RHEL6 installations, the <tt>vmlinux</tt> file
is part of the kernel debuginfo package, and is found in the relevant
<tt>/usr/lib/debug/lib/modules/&lt;release></tt> directory.
<p>
Ideally the kernel object file
is the same kernel object file that is associated with the memory
image.  However, in circumstances where the <tt>vmlinux</tt> file
associated with the crash dump or live system was <b><i>not</i></b> built
with the <tt>-g</tt> flag, there are work-arounds discussed later in the

<a href="#NODASHG" class="bluelinkbold">Invocation</a> section.
</dd>
<dt><br><b>memory image:</b></dt>
<dd><br>
This may consist of a kernel crash dump file generated from
any of the <a href="#SUPPORTED" class="bluelinkbold">supported dump facilties</a>, or
live system memory accessed via <tt>/dev/mem</tt> or its replacement in RHEL4/RHEL5/RHEL6, the <tt>/dev/crash</tt> driver.
If no dump file argument is issued on the <tt>crash</tt> command line,
live system memory will be used by default.  When examining a live
system, root privileges are required.  

</dd>
<dt><br><b>platform processor types:</b></dt>
<dd><br>
The <tt>crash</tt> utility is actively developed and tested on the 
x86, x86_64, ia64, ppc64, arm, s390 and s390x processors.  Legacy support for the Alpha and 32-bit PowerPC
platforms exists, but no longer actively maintained.  
</dd>
<dt><br><b>Linux kernel versions:</b></dt>
<dd><br>
The <tt>crash</tt> utility is backwards-compatible to at least 
Red Hat 6.0 (Linux version 2.2.5-15), up to Red Hat 
Enterprise Linux 5 (Linux version 2.6.18+).  
Due to the constantly shifting sands of the upstream kernel internals, immediate 
support for the latest kernel versions cannot be guaranteed.  However,
modifications are constantly being
implemented to support changes in upstream kernel versions.
The intent has always been to make the utility independent of Linux version dependencies,
building in recognition of major kernel code changes so as to adapt to
new kernel versions, while maintaining backwards compatibility.
</dd>

</dl>
</blockquote>
<p><br></p>




<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="BUILD_PROCEDURE"></a> <hr> <p>




<p>
<h3>Build Procedure</h3>
<p>Starting with the RHEL3 release, the <tt>crash</tt> utility
is automatically installed during system installation if the 
<b>Development Tools</b> package set is selected.  However, for all other 
kernel versions, or if it was not selected during system installation, 
the binary RPM can be installed, or if desired, the sources re-built and installed.
<p>
If the <tt>crash</tt> utility is not pre-installed, and if all dependencies 
are met on the target system, install the binary RPM like so:

<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>rpm -ivh crash-4.0-8.11.i386.rpm</b>
Preparing...                ########################################### [100%]
   1:crash                  ########################################### [100%]
#
</pre>
</td>
</tr>
</table>
<p>The <tt>crash</tt> executable will be installed in the

<tt>/usr/bin</tt> directory.
<p>
Alternatively, the <tt>crash</tt> source code can be rebuilt.  
The <tt>crash</tt> utility's source files come packaged in two typical 
formats, 
a <a href="#TAR_GZ">compressed tar image</a>.
or a <a href="#SRC_RPM">source RPM file</a>, 
So, for example,
<tt>crash</tt> version 4.0-8.11 can be built from either 

<tt>crash-4.0-8.11.tar.gz</tt> or 
<tt>crash-4.0-8.11.src.rpm</tt>.
<p>
The latest "upstream" version of the <tt>crash</tt> utility, 
available in both file formats, can be found
here: <a href="https://crash-utility.github.io/">https://crash-utility.github.io/</a>
<p>
In either case, the source file layout consists of a top-level directory
containing a set of <tt>crash</tt>-specific files, a compressed tar image
containing the full, unmodified, <tt>gdb</tt> source tree,
and a small number of modified <tt>gdb</tt> files required to merge the
two entities.  The build
procedure does the following:

<ol>
<li>the unmodified <tt>gdb</tt> sources are extracted into a subdirectory of the
top-level <tt>crash</tt> source directory, and overlayed by the small set
of modified <tt>gdb</tt> files.
</li>
<li>the files in the <tt>gdb</tt> source tree are built first, creating the
<tt>libbfd.a</tt>, <tt>libreadline.a</tt>, <tt>libopcodes.a</tt>, 

<tt>libiberty.a</tt> and <tt>libgdb.a</tt> libraries.
</li>
<li>the <tt>crash</tt> sources files in the top-level directory are 
then compiled into a <tt>crashlib.a</tt> library.
</li>
<li>the objects are all linked into the <tt>crash</tt> executable, 
located in the top-level directory.

</ol>
Depending upon the speed of the host system, the complete build may take 
several minutes, primarily due to the time consumed by the build of
the <tt>gdb</tt> portion.
</p>
<a name="TAR_GZ"><hr></a>
<h4>Building from the tar image</h4>
<p>
To build from the compressed tar image, simply uncompress/extract the
source files, <tt>cd</tt> into the resultant source directory,
and enter <tt>make</tt>: 
<p>

<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>tar xvzmf crash-4.0-8.11.tar.gz</b>
crash-4.0-8.11/
crash-4.0-8.11/main.c
crash-4.0-8.11/tools.c
crash-4.0-8.11/global_data.c
crash-4.0-8.11/memory.c
crash-4.0-8.11/filesys.c
crash-4.0-8.11/help.c
crash-4.0-8.11/task.c
crash-4.0-8.11/kernel.c
crash-4.0-8.11/test.c
crash-4.0-8.11/gdb_interface.c
crash-4.0-8.11/configure.c
crash-4.0-8.11/net.c
crash-4.0-8.11/dev.c
crash-4.0-8.11/alpha.c
crash-4.0-8.11/x86.c
crash-4.0-8.11/ppc.c
crash-4.0-8.11/ia64.c
crash-4.0-8.11/s390.c
crash-4.0-8.11/s390x.c
crash-4.0-8.11/s390dbf.c
crash-4.0-8.11/ppc64.c
crash-4.0-8.11/x86_64.c
crash-4.0-8.11/extensions.c
crash-4.0-8.11/remote.c
crash-4.0-8.11/va_server.c
crash-4.0-8.11/va_server_v1.c
crash-4.0-8.11/symbols.c
crash-4.0-8.11/cmdline.c
crash-4.0-8.11/lkcd_common.c
crash-4.0-8.11/lkcd_v1.c
crash-4.0-8.11/lkcd_v2_v3.c
crash-4.0-8.11/lkcd_v5.c
crash-4.0-8.11/lkcd_v7.c
crash-4.0-8.11/lkcd_v8.c
crash-4.0-8.11/lkcd_fix_mem.c
crash-4.0-8.11/s390_dump.c
crash-4.0-8.11/lkcd_x86_trace.c
crash-4.0-8.11/netdump.c
crash-4.0-8.11/diskdump.c
crash-4.0-8.11/xendump.c
crash-4.0-8.11/unwind.c
crash-4.0-8.11/unwind_decoder.c
crash-4.0-8.11/unwind_x86_32_64.c
crash-4.0-8.11/xen_hyper.c
crash-4.0-8.11/xen_hyper_command.c
crash-4.0-8.11/xen_hyper_global_data.c
crash-4.0-8.11/xen_hyper_dump_tables.c
crash-4.0-8.11/defs.h
crash-4.0-8.11/xen_hyper_defs.h
crash-4.0-8.11/va_server.h
crash-4.0-8.11/vas_crash.h
crash-4.0-8.11/netdump.h
crash-4.0-8.11/diskdump.h
crash-4.0-8.11/xendump.h
crash-4.0-8.11/unwind.h
crash-4.0-8.11/unwind_i.h
crash-4.0-8.11/rse.h
crash-4.0-8.11/unwind_x86.h
crash-4.0-8.11/unwind_x86_64.h
crash-4.0-8.11/lkcd_vmdump_v1.h
crash-4.0-8.11/lkcd_vmdump_v2_v3.h
crash-4.0-8.11/lkcd_dump_v5.h
crash-4.0-8.11/lkcd_dump_v7.h
crash-4.0-8.11/lkcd_dump_v8.h
crash-4.0-8.11/lkcd_x86_trace.h
crash-4.0-8.11/lkcd_fix_mem.h
crash-4.0-8.11/ibm_common.h
crash-4.0-8.11/Makefile
crash-4.0-8.11/gdb-6.1/
crash-4.0-8.11/gdb-6.1/gdb/
crash-4.0-8.11/gdb-6.1/gdb/Makefile.in
crash-4.0-8.11/gdb-6.1/gdb/main.c
crash-4.0-8.11/gdb-6.1/gdb/symtab.c
crash-4.0-8.11/gdb-6.1/gdb/target.c
crash-4.0-8.11/gdb-6.1/gdb/symfile.c
crash-4.0-8.11/gdb-6.1/gdb/elfread.c
crash-4.0-8.11/gdb-6.1/gdb/ui-file.c
crash-4.0-8.11/gdb-6.1/gdb/utils.c
crash-4.0-8.11/gdb-6.1/gdb/dwarf2read.c
crash-4.0-8.11/gdb-6.1/gdb/ppc-linux-tdep.c
crash-4.0-8.11/gdb-6.1/Makefile.in
crash-4.0-8.11/gdb-6.1/include/
crash-4.0-8.11/gdb-6.1/include/obstack.h
crash-4.0-8.11/gdb-6.1.patch
crash-4.0-8.11/COPYING
crash-4.0-8.11/.rh_rpm_package
crash-4.0-8.11/crash.8
crash-4.0-8.11/extensions/
crash-4.0-8.11/extensions/Makefile
crash-4.0-8.11/extensions/echo.c
crash-4.0-8.11/extensions/dminfo.c
crash-4.0-8.11/extensions/libsial/
crash-4.0-8.11/extensions/libsial/Makefile
crash-4.0-8.11/extensions/libsial/mkbaseop.c
crash-4.0-8.11/extensions/libsial/README
crash-4.0-8.11/extensions/libsial/README.sial
crash-4.0-8.11/extensions/libsial/sial_alloc.c
crash-4.0-8.11/extensions/libsial/sial_api.c
crash-4.0-8.11/extensions/libsial/sial_api.h
crash-4.0-8.11/extensions/libsial/sial_builtin.c
crash-4.0-8.11/extensions/libsial/sial_case.c
crash-4.0-8.11/extensions/libsial/sial_define.c
crash-4.0-8.11/extensions/libsial/sial_func.c
crash-4.0-8.11/extensions/libsial/sial.h
crash-4.0-8.11/extensions/libsial/sial_input.c
crash-4.0-8.11/extensions/libsial/sial.l
crash-4.0-8.11/extensions/libsial/sial-lsed
crash-4.0-8.11/extensions/libsial/sial_member.c
crash-4.0-8.11/extensions/libsial/sial_node.c
crash-4.0-8.11/extensions/libsial/sial_num.c
crash-4.0-8.11/extensions/libsial/sial_op.c
crash-4.0-8.11/extensions/libsial/sialpp.l
crash-4.0-8.11/extensions/libsial/sialpp-lsed
crash-4.0-8.11/extensions/libsial/sialpp.y
crash-4.0-8.11/extensions/libsial/sial_print.c
crash-4.0-8.11/extensions/libsial/sial_stat.c
crash-4.0-8.11/extensions/libsial/sial_str.c
crash-4.0-8.11/extensions/libsial/sial_type.c
crash-4.0-8.11/extensions/libsial/sial_util.c
crash-4.0-8.11/extensions/libsial/sial_var.c
crash-4.0-8.11/extensions/libsial/sial.y
crash-4.0-8.11/extensions/sial.c
crash-4.0-8.11/extensions/sial.mk
crash-4.0-8.11/gdb-6.1.tar.gz
crash-4.0-8.11/README
# <b>cd crash-4.0-8.11</b>
# <b>make</b>
TARGET: X86
 CRASH: 4.0-8.11
   GDB: 6.1
gdb-6.1/gdb/CONTRIBUTE
gdb-6.1/gdb/COPYING
gdb-6.1/gdb/ChangeLog
gdb-6.1/gdb/ChangeLog-1990
gdb-6.1/gdb/ChangeLog-1991
gdb-6.1/gdb/ChangeLog-1992
gdb-6.1/gdb/ChangeLog-1993
gdb-6.1/gdb/ChangeLog-1994
gdb-6.1/gdb/ChangeLog-1995
gdb-6.1/gdb/ChangeLog-1996
gdb-6.1/gdb/ChangeLog-1997
gdb-6.1/gdb/ChangeLog-1998
gdb-6.1/gdb/ChangeLog-1999
gdb-6.1/gdb/ChangeLog-2000
gdb-6.1/gdb/ChangeLog-2001
gdb-6.1/gdb/ChangeLog-2002
gdb-6.1/gdb/ChangeLog-2003
gdb-6.1/gdb/ChangeLog-3.x
gdb-6.1/gdb/MAINTAINERS
gdb-6.1/gdb/NEWS
gdb-6.1/gdb/PROBLEMS
gdb-6.1/gdb/README
gdb-6.1/gdb/TODO
gdb-6.1/gdb/abug-rom.c
gdb-6.1/gdb/acconfig.h
gdb-6.1/gdb/acinclude.m4
gdb-6.1/gdb/aclocal.m4
gdb-6.1/gdb/ada-exp.y
gdb-6.1/gdb/ada-lang.c
gdb-6.1/gdb/ada-lang.h

  <i>(complete output not shown)</i>

ar -rs crashlib.a main.o tools.o global_data.o memory.o filesys.o help.o task.o
build_data.o kernel.o test.o gdb_interface.o net.o dev.o alpha.o x86.o ppc.o ia6
4.o s390.o s390x.o s390dbf.o ppc64.o x86_64.o extensions.o remote.o va_server.o 
va_server_v1.o symbols.o cmdline.o lkcd_common.o lkcd_v1.o lkcd_v2_v3.o lkcd_v5.
o lkcd_v7.o lkcd_v8.o lkcd_fix_mem.o s390_dump.o netdump.o diskdump.o xendump.o 
lkcd_x86_trace.o unwind_v1.o unwind_v2.o unwind_v3.o unwind_x86_32_64.o xen_hype
r.o xen_hyper_command.o xen_hyper_global_data.o xen_hyper_dump_tables.o
ar: creating crashlib.a
gcc -g -O2       \
                -o `cat mergeobj` libgdb.a \
                   ../bfd/libbfd.a ../readline/libreadline.a ../opcodes/libopcod
es.a  ../libiberty/libiberty.a     -lm -lncurses  ../libiberty/libiberty.a  -ldl
 -rdynamic `cat mergelibs`
#
</pre>
</td>
</tr>
</table>
<p>The resultant <tt>crash</tt> executable will be located in the 
top-level source directory.  Install it in <tt>/usr/bin</tt>
by entering:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>

# <b>make install</b>
/usr/bin/install crash /usr/bin
#
</pre>
</td>
</tr>
</table>
<a name="SRC_RPM"><hr></a>
<h4>Building from the source RPM</h4>
<p>
To build from the source RPM, install the <tt>crash-4.0-8.11.src.rpm</tt>, 
<tt>cd</tt> to the appropriate <tt>SPECS</tt> directory, 
and build the package:

<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>rpm -Uvh crash-4.0-8.11.src.rpm</b>
   1:crash                  ########################################### [100%]
# <b>cd /usr/src/redhat/SPECS</b>
# <b>rpmbuild -ba crash.spec</b>
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.19005
+ umask 022
+ cd /usr/src/redhat/BUILD
+ LANG=C
+ export LANG
+ unset DISPLAY
+ cd /usr/src/redhat/BUILD
+ rm -rf crash-4.0-8.11
+ /bin/gzip -dc /usr/src/redhat/SOURCES/crash-4.0-8.11.tar.gz
+ tar -xvvf -
drwxr-xr-x root/root         0 2002-09-12 16:51:40 crash-4.0-8.11/
-rwxrwxr-x root/root     31916 2002-09-12 16:51:40 crash-4.0-8.11/main.c
-rwxrwxr-x root/root    103454 2002-09-12 16:51:40 crash-4.0-8.11/tools.c
-rwxrwxr-x root/root      5802 2002-09-12 16:51:40 crash-4.0-8.11/global_data.c
-rwxrwxr-x root/root    225343 2002-09-12 16:51:40 crash-4.0-8.11/memory.c
-rwxrwxr-x root/root     75492 2002-09-12 16:51:40 crash-4.0-8.11/filesys.c
-rwxrwxr-x root/root    211519 2002-09-12 16:51:40 crash-4.0-8.11/help.c
-rwxrwxr-x root/root    110604 2002-09-12 16:51:40 crash-4.0-8.11/task.c
-rwxrwxr-x root/root    101805 2002-09-12 16:51:40 crash-4.0-8.11/kernel.c
-rwxrwxr-x root/root      2198 2002-09-12 16:51:40 crash-4.0-8.11/test.c
-rwxrwxr-x root/root     18949 2002-09-12 16:51:40 crash-4.0-8.11/gdb_interface.c
-rwxrwxr-x root/root     20239 2002-09-12 16:51:40 crash-4.0-8.11/configure.c
-rwxrwxr-x root/root     29931 2002-09-12 16:51:40 crash-4.0-8.11/net.c
-rwxrwxr-x root/root     99654 2002-09-12 16:51:40 crash-4.0-8.11/dev.c
-rwxrwxr-x root/root     76146 2002-09-12 16:51:40 crash-4.0-8.11/alpha.c
-rwxrwxr-x root/root     74638 2002-09-12 16:51:40 crash-4.0-8.11/x86.c
-rwxrwxr-x root/root     42109 2002-09-12 16:51:40 crash-4.0-8.11/ppc.c
-rwxrwxr-x root/root     76357 2002-09-12 16:51:40 crash-4.0-8.11/ia64.c

  <i>(complete output not shown)</i>

Requires: libc.so.6 libc.so.6(GLIBC_2.0) libc.so.6(GLIBC_2.1) libc.so.6(GLIBC_2.
2) libc.so.6(GLIBC_2.2.3) libc.so.6(GLIBC_2.3) libdl.so.2 libdl.so.2(GLIBC_2.0)
libdl.so.2(GLIBC_2.1) libm.so.6 libm.so.6(GLIBC_2.0) libncurses.so.5 libz.so.1
Processing files: crash-debuginfo-4.0-8.11
Requires(rpmlib): rpmlib(CompressedFileNames) <= 3.0.4-1 rpmlib(PayloadFilesHave
Prefix) <= 4.0-1
Checking for unpackaged file(s): /usr/lib/rpm/check-files /var/tmp/crash-root
Wrote: /usr/src/redhat/SRPMS/crash-4.0-8.11.src.rpm
<b>Wrote: /usr/src/redhat/RPMS/i386/crash-4.0-8.11.i386.rpm</b>
Wrote: /usr/src/redhat/RPMS/i386/crash-debuginfo-4.0-8.11.i386.rpm
#
</pre>
</td>
</tr>
</table>
<p>
Lastly, install the binary RPM, which copies the <tt>crash</tt>
executable to the <tt>/usr/bin</tt> directory:

<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>rpm -ivh /usr/src/redhat/RPMS/i386/crash-4.0-8.11.i386.rpm </b>
Preparing...                ########################################### [100%]
   1:crash
#
</pre>
</td>
</tr>
</table>
<br>





<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="INVOCATION"></a> <hr> <p>








<p>
<h3>Invocation</h3>
<p>When <tt>crash</tt> is run on a dumpfile, at least two arguments are 
always required:
<ol>
<li>
The kernel object filename, often referred to as the kernel <i><b>namelist</b></i>.
When initially built from the kernel sources, its name is <tt>vmlinux</tt>.
In RHEL3 installations, it is copied to the <tt>/boot</tt> directory, where the 
operating system release number is appended, as in

<tt>vmlinux-2.4.21-4.ELsmp</tt>.  In RHEL4, RHEL5 and RHEL6 installations, the <tt>vmlinux</tt> file
is part of the kernel debuginfo package, and is located in the relevant
<tt>/usr/lib/debug/lib/modules/&lt;release></tt> directory.
</li>
<li>
The dumpfile name, typically named <tt>vmcore</tt>.
</li>
</ol>
For example, if both files are located in the current directory:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash vmlinux vmcore
</pre>
</td>
</tr>
</table>
<p>
When <tt>crash</tt> is run on a live system, <tt>/dev/mem</tt> is used as the
memory image.  In RHEL4, RHEL5 and RHEL6, the <tt>/dev/mem</tt> driver is restricted
on x86 and x86_64 systems, and is replaced by the <tt>/dev/crash</tt> driver.
In any case, only the kernel object filename is required:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash vmlinux
</pre>
</td>
</tr>
</table> 
<p>Furthermore, when <tt>crash</tt> is run on a live system,  
the <tt>vmlinux</tt> argument is <b><i>not</i></b> required when the kernel
object file is located in any of the following locations:

<ul>
<li><tt>/boot</tt></li>
<li><tt>/usr/lib/debug/lib/modules/&lt;<i>release</i>></li>
<li><tt>/</tt>  (root directory)</li>
<li>any subdirectory of <tt>/usr/src</tt></li>
<li><tt>/usr/src/redhat/BUILD/kernel-</tt><i>x.x.x</i>/linux-&lt;<i>release</i>></li>

</ul>
</tt>
<p>
When the <tt>vmlinux</tt> file is not entered on the command line, a search
will be made in all of the directories above until a kernel object file
is found that contains a version string that matches the running
kernel, as indicated by <tt>/proc/version</tt>.
If a matching kernel is found, then <tt>crash</tt> may be invoked on
a live system simply by entering:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>

# crash
</pre>
</td>
</tr>
</table>
<p>In the examples above, it is presumed that the <tt>vmlinux</tt> kernel
has been built with the <tt>-g</tt> C flag, which traditionally has not
been done by default.  To address this requirement, starting with Red Hat Enterprise Linux 3 
(RHEL3), all RHEL kernels are
now built with <tt>-g</tt> C flag.  The manner of accessing the
debug data for 
<a href="#RHEL3DASHG">RHEL3</a>,

<a href="#RHEL4DASHG">RHEL4</a>,
<a href="#RHEL5DASHG">RHEL5</a> and
<a href="#RHEL6DASHG">RHEL6</a>
kernels is described in the following sections.
Unfortunately, since RHEL2.1 kernels are not built with <tt>-g</tt>, the
kernel must be rebuilt; 
directions for rebuilding 
<a href="help_pages/kernel_rebuild.html">RHEL2.1</a>
kernels can
be found 
<a href="help_pages/kernel_rebuild.html">here.</a>
<h3><a name="RHEL3DASHG">RHEL3 Kernels</a></h3>
In RHEL3, the <tt>vmlinux</tt> kernel debug information is stripped
and stored in a separate debuginfo file. 
The stripped <tt>vmlinux</tt> file in <tt>/boot</tt> has
an embedded link to its associated debuginfo file in 

<tt>/usr/lib/debug/boot</tt>, so that the <tt>crash</tt> utility (and the
built-in <tt>gdb</tt> module) knows 
where to find it:
<p>
<table border="2" width="100%" cellpadding="8">
<tr align="center">
  <td>RHEL3 kernel namelist in <tt>/boot</tt></td>
  <td>RHEL3 kernel debuginfo file in <tt>/usr/lib/debug/boot</tt></td>

</tr>
<tr>
  <td>
  <tt>vmlinux-</tt><i>&lt;release></i><tt>.EL</tt>
  <br>
  <tt>vmlinux-</tt><i>&lt;release></i><tt>.ELsmp</tt>
  <br>

  <tt>vmlinux-</tt><i>&lt;release></i><tt>.ELhugemem</tt>
  </td>
  <td>
  <tt>vmlinux-</tt><i>&lt;release></i><tt>.EL.debug</tt>
  <br>
  <tt>vmlinux-</tt><i>&lt;release></i><tt>.ELsmp.debug</tt>

  <br>
  <tt>vmlinux-</tt><i>&lt;release></i><tt>.ELhugemem.debug</tt>
  </td>
</td>
</tr>
</table>
<p>
The debuginfo files for a specific kernel <i>&lt;release></i> come from a 
separate RPM that must be installed for the <tt>crash</tt>

utility to work.  For example, the i686 RPM for the examples above would
be named <tt>kernel-debuginfo-</tt><i>&lt;release&gt;</i><tt>.i686.rpm</tt>,
and would install the debuginfo file for all three of the kernel flavors.
<p>
For example, to run <tt>crash</tt> on a live system, the associated
debuginfo package must be installed:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# uname -r
2.4.21-4.ELsmp
# rpm -ivh kernel-debuginfo-2.4.21-4.EL.i686.rpm
Preparing...                ########################################### [100%]
   1:kernel-debuginfo       ########################################### [100%]
# ls /usr/lib/debug/boot
vmlinux-2.4.21-4.EL.debug
vmlinux-2.4.21-4.ELhugemem.debug
vmlinux-2.4.21-4.ELsmp.debug
#
</pre>

</td>
</tr>
</table>
<p>
Accordingly, if the running kernel's <tt>vmlinux</tt>
file is in one the search locations above, <i><b>and</b></i> its associated
debuginfo file is located in
the <tt>/usr/lib/debug/boot</tt> directory <i><b>or</b></i> in the
current directory from which <tt>crash</tt> is invoked, no arguments
are required to run on a live system:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash
</pre>
</td>
</tr>
</table>
<p>
However, if the linked debuginfo file is not in either of those locations,
it can be added to the <tt>crash</tt> command line along with the 
<tt>vmlinux</tt> filename. So, for example, if the debuginfo file was
located in <tt>/tmp</tt>:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash /boot/vmlinux-2.4.21-4.ELsmp /tmp/vmlinux-2.4.21-4.ELsmp.debug
</pre>
</td>
</tr>
</table>
<p>
For analyzing dumpfiles however, the <tt>vmlinux</tt> file name must be on the command
line along with the dumpfile name, as in the following examples:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">

<tr>
<td>
<pre>
# crash /boot/vmlinux-2.4.21-4.ELsmp vmcore
</pre>
</td>
</tr>
</table>
<p>
or if the debuginfo file is not in the standard location:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash /boot/vmlinux-2.4.21-4.ELsmp /tmp/vmlinux-2.4.21-4.ELsmp.debug vmcore
</pre>

</td>
</tr>
</table>
<p>
<h3><a name="RHEL4DASHG">RHEL4 Kernels</a></h3>
The procedure has been made much simpler for RHEL4 kernels.  The kernel
is built with the <tt>-g</tt> flag, and the resultant <tt>vmlinux</tt>
file is stored in the associated debuginfo package.  
After installing the debuginfo package, the <tt>vmlinux</tt> file for each kernel
flavor of a given RHEL4 release will be installed in the directory named:
</p>

<tt>/usr/lib/debug/lib/modules/&lt;</tt><i>release</i>>&lt;<i>flavor</i>><tt>/vmlinux</tt>
<p>
where for i686 kernels,
&lt;<i>flavor</i>> can be either <tt>hugemem</tt>, <tt>smp</tt>, or nothing (for uniprocessor
kernels).  For example:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">

<tr>
<td>
<pre>
# uname -r
2.6.9-6.39.ELsmp
# rpm -ivh kernel-debuginfo-2.6.9-6.39.EL.i686.rpm
Preparing...                ########################################### [100%]
   1:kernel-debuginfo       ########################################### [100%]
#
# find /usr/lib/debug/lib/modules/2.6.9-6.39.EL* -name vmlinux
/usr/lib/debug/lib/modules/2.6.9-6.39.ELhugemem/vmlinux
/usr/lib/debug/lib/modules/2.6.9-6.39.ELsmp/vmlinux
/usr/lib/debug/lib/modules/2.6.9-6.39.EL/vmlinux
#
</pre>
</td>
</tr>
</table>
<p>
Once the debuginfo package is installed, <tt>crash</tt> can be invoked on the live system
with no arguments, because the <tt>vmlinux</tt> file will be found automatically:
</p>

<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash
</pre>
</td>
</tr>
</table>
<p>
To run <tt>crash</tt> on a dumpfile, however, the appropriate <tt>vmlinux</tt>
file and the dumpfile name must both be on the command line, as in:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash /usr/lib/debug/lib/modules/2.6.9-6.39.ELsmp/vmlinux vmcore 
</pre>
</td>
</tr>
</table>
<p>
<h3><a name="RHEL5DASHG">RHEL5 Kernels</a></h3>
RHEL5 kernels are also built with the <tt>-g</tt> flag, and the resultant <tt>vmlinux</tt>
file is stored in an associated debuginfo package.  Unlike RHEL4, the kernel debuginfo packages
are split into one package per flavor plus a "common" package user by all kernel flavors.
After installing the debuginfo package, the <tt>vmlinux</tt> file for each kernel
flavor of a given RHEL5 release will be installed in the directory named:
</p>
<tt>/usr/lib/debug/lib/modules/&lt;</tt><i>release</i>>&lt;<i>flavor</i>><tt>/vmlinux</tt>
<p>
where for i686 kernels, there are 4 possible
&lt;<i>flavor</i>>s, either <tt>PAE</tt>, <tt>xen</tt>, <tt>debug</tt>, or nothing
(for non-PAE SMP kernels).  For example:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# rpm -ivh kernel-debuginfo-2.6.18-66.el5.i686.rpm \
           kernel-PAE-debuginfo-2.6.18-66.el5.i686.rpm \
           kernel-xen-debuginfo-2.6.18-66.el5.i686.rpm \
           kernel-debuginfo-common-2.6.18-66.el5.i686.rpm
Preparing...                ########################################### [100%]
   1:kernel-debuginfo-common########################################### [ 25%]
   2:kernel-debuginfo       ########################################### [ 50%]
   3:kernel-PAE-debuginfo   ########################################### [ 75%]
   4:kernel-xen-debuginfo   ########################################### [100%]
# find /usr/lib/debug/lib/modules/2.6.18-66.el5* -name vmlinux
/usr/lib/debug/lib/modules/2.6.18-66.el5/vmlinux
/usr/lib/debug/lib/modules/2.6.18-66.el5PAE/vmlinux
/usr/lib/debug/lib/modules/2.6.18-66.el5xen/vmlinux
#
</pre>
</td>
</tr>
</table>
<p>
Once the debuginfo package is installed, <tt>crash</tt> can be invoked on the live system
with no arguments, because the <tt>vmlinux</tt> file will be found automatically:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash
</pre>
</td>
</tr>
</table>
<p>
To run <tt>crash</tt> on a dumpfile, however, the appropriate <tt>vmlinux</tt>

file and the dumpfile name must both be on the command line, as in:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash /usr/lib/debug/lib/modules/2.6.18-66.el5/vmlinux vmcore
</pre>
</td>
</tr>
</table>

<h3><a name="RHEL6DASHG">RHEL6 Kernels</a></h3>
RHEL6 kernels are also built with the <tt>-g</tt> flag, and the resultant <tt>vmlinux</tt>
file is stored in an associated debuginfo package.  Like RHEL5, the kernel debuginfo packages
are split into one package per flavor plus a "common" package user by all kernel flavors.
After installing the debuginfo package, the <tt>vmlinux</tt> file for each kernel
flavor of a given RHEL6 release will be installed in the directory named:
</p>
<tt>/usr/lib/debug/lib/modules/&lt;</tt><i>release</i>>&lt;<i>flavor</i>><tt>/vmlinux</tt>
<p>
where for x86_64 kernels, there are only 2 possible
&lt;<i>flavor</i>>s, either the standard kernel or the <tt>debug</tt> kernel.  For example:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# rpm -ivh kernel-debuginfo-common-2.6.32-70.el6.x86_64.rpm \
           kernel-debuginfo-2.6.32-70.el6.x86_64.rpm \
           kernel-debug-debuginfo-2.6.32-70.el6.x86_64.rpm
Preparing...                ########################################### [100%]
   1:kernel-debuginfo-common########################################### [ 25%]
   2:kernel-debuginfo       ########################################### [ 50%]
   3:kernel-debug-debuginfo ########################################### [100%]
# find /usr/lib/debug/lib/modules/2.6.32-70.el6* -name vmlinux
/usr/lib/debug/lib/modules/2.6.32-70.el6/vmlinux
/usr/lib/debug/lib/modules/2.6.32-70.el6debug/vmlinux
#
</pre>
</td>
</tr>
</table>
<p>
Once the debuginfo package is installed, <tt>crash</tt> can be invoked on the live system
with no arguments, because the <tt>vmlinux</tt> file will be found automatically:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash
</pre>
</td>
</tr>
</table>
<p>
To run <tt>crash</tt> on a dumpfile, however, the appropriate <tt>vmlinux</tt>

file and the dumpfile name must both be on the command line, as in:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash /usr/lib/debug/lib/modules/2.6.32-70.el6/vmlinux vmcore
</pre>
</td>
</tr>
</table>

<p>
<h3><a name="NODASHG">RHEL2.1 Kernels (or kernels built without <tt>-g</tt> flag)</a></h3>

<p>
If the running kernel was <b><i>not</i></b> built with the <tt>-g</tt> C flag,
then it is necessary to rebuild a kernel of the same configuration with 
the <tt>-g</tt> C flag.  
The essential change done by this kernel rebuild task is a modification
of top-level <tt>Makefile</tt> of the kernel source tree, 
such that the <tt>CFLAGS</tt> definition contains the <tt>-g</tt> flag.
For example, this is the line that must be changed:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
CFLAGS := $(CPPFLAGS) -Wall -Wstrict-prototypes -Wno-trigraphs -O2 \
          -fno-strict-aliasing -fno-common
</pre>
</td>
</tr>
</table>
<p>by adding the <tt>-g</tt> flag:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>

<td>
<pre>
CFLAGS := $(CPPFLAGS) -Wall -Wstrict-prototypes -Wno-trigraphs -O2 \
          -fno-strict-aliasing -fno-common <b>-g</b>
</pre>
</td>
</tr>
</table>
<p>
For example, since RHEL2.1 kernels are <i>not</i> built with <tt>-g</tt>, a kernel
rebuild is required.
For a detailed example of how to rebuild a RHEL2.1 kernel 
with the <tt>-g</tt> flag, please refer to these 

<a href="help_pages/kernel_rebuild.html">directions</a>.  
<p>
Upon rebuilding the kernel, a new
<tt>vmlinux</tt> file will be created that contains the debug data
required by <tt>crash</tt>.  However, the symbol values will not match
those of the running or dumped kernel.  To deal with this inequity, the 
actual symbol values can be gathered from
either the original <i>non</i>-debug <tt>vmlinux</tt> file <i>or</i> from its
associated System.map file.  That being the case, two arguments must
be supplied to <tt>crash</tt> to fully describe the running/dumped kernel,
the newly-created <tt>vmlinux</tt> file compiled with <tt>-g</tt>, as well as a source of the
real symbol values.
So, for example, if the <tt>vmlinux</tt> file
built with <tt>-g</tt> were renamed to <tt>vmlinux.dbg</tt>, the invocation
line would look like this on a live system: 

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash vmlinux vmlinux.dbg
<i>(or)</i>
# crash /boot/System.map vmlinux.dbg
<i>(or)</i>
# crash -S vmlinux.debug
</pre>
</td>
</tr>
</table>
<p>

The <tt>-S</tt> argument above is simply an alternative to 
entering the default <tt>/boot/System.map</tt> string.
<p>
<p>Similarly, when looking at a dumpfile, two arguments are required
to describe the dumped kernel, along with the <tt>vmcore</tt> image:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>

# crash vmlinux vmlinux.dbg vmcore
<i>(or)</i>
# crash /boot/System.map vmlinux.dbg vmcore 
<i>(or)</i>
# crash -S vmlinux.dbg vmcore 
</pre>
</td>
</tr>
</table>
<p>
Again, for a detailed example of how to rebuild a RHEL2.1 kernel 
with the <tt>-g</tt> flag, refer to these 
<a href="help_pages/kernel_rebuild.html">directions</a>.

<h3>Invocation output</h3>
<p>
The arguments may be entered in any order.  If the file arguments are not
in the current directory, absolute pathnames must be used.  
When in doubt, simply enter <tt>crash -h</tt> to get an explanation of
the command line arguments:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>crash -h</b>

Usage:
  crash [-h [opt]][-v][-s][-i file][-d num] [-S] [mapfile] [namelist] [dumpfile]

  [namelist]
    The [namelist] argument is a pathname to an uncompressed kernel image
    (a vmlinux file) that has been compiled with the "-g" switch, or
    that has an accessible, associated, debuginfo file.  If the [dumpfile]
    argument is entered, then the [namelist] argument must be entered
    If the [namelist] argument is not entered when running on a live
    system, a search will be made in several typical directories for
    for a kernel namelist file that matches the live system.
 
  [dumpfile]
    The [dumpfile] argument is a pathname to a kernel memory core dump
    file.  If the [dumpfile] argument is not entered, the session will be
    invoked on the live system using /dev/mem, which usually requires root
    privileges.
 
  [mapfile]
    If the live system kernel, or the kernel from which the [dumpfile] 
    was derived, was not compiled with the -g switch, then the additional
    [mapfile] argument is required.  The [mapfile] argument may consist
    of either the associated System.map file, or the non-debug kernel
    namelist.  However, if the [mapfile] argument is used, then the
    [namelist] argument must be a kernel namelist of a similar kernel
    version that was built with the -g switch.
 
  [-S]
    Use "/boot/System.map" as the [mapfile].
 
    Examples when running on a live system:
 
      $ crash
      $ crash /usr/tmp/vmlinux
      $ crash /boot/System.map vmlinux.dbg
      $ crash -S vmlinux.dbg
      $ crash vmlinux vmlinux.dbg
 
    Examples when running on a dumpfile:
 
      $ crash vmlinux vmcore
      $ crash /boot/System.map vmlinux.dbg vmcore
      $ crash -S vmlinux.dbg vmcore
      $ crash vmlinux vmlinux.dbg vmcore
 
  [-h [opt]]
    The -h option alone displays this message.  If the [opt] argument is
    a crash command name, the help page for that command is displayed.  If
    the string "input" is entered, a page describing the various crash
    command line input options is displayed.  If the string "output" is
    entered, a page describing command line output options is displayed.
 
  [-v]
    Display the versions of crash and gdb making up this executable.
 
  [-s]
    Do not display any version, GPL, or crash initialization data; proceed
    directly to the "crash>" prompt.
 
  [-i file]
    Execute the crash command(s) in [file] prior to accepting any user
    input from the "crash>" prompt.
 
  [-d num]
    Set crash debug level [num].  The higher the number, the more debug data
    will be printed during crash runtime.

</pre>
</td>
</tr>
</table>
<p>
Given that all invocation arguments are in order, here is an example of
a successful invocation on a dumpfile, running a kernel that was built 
with <tt>-g</tt>, along with
a <tt>vmcore</tt> dump file was 
created by the Red Hat Netdump facility:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>crash vmlinux-2.4.20-2.1.15.entsmp vmcore</b>

crash 4.0-8.11
Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007, 2008  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter "help copying" to see the conditions.
This program has absolutely no warranty.  Enter "help warranty" for details.

GNU gdb 6.1
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu"...

      <b>KERNEL: vmlinux-2.4.20-2.1.15.entsmp
    DUMPFILE: vmcore</b>
        CPUS: 1
        DATE: Wed Mar 12 10:12:56 2003
      UPTIME: 00:38:25
LOAD AVERAGE: 1.16, 0.74, 0.30
       TASKS: 60
    NODENAME: dhcp64-220.boston.redhat.com
     RELEASE: 2.4.20-2.1.15.entsmp
     VERSION: #1 SMP Tue Mar 11 16:12:22 EST 2003
     MACHINE: i686  (501 Mhz)
      MEMORY: 128 MB
       PANIC: "Oops: 0002" (check log for details)
         PID: 0
     COMMAND: "swapper"
        TASK: c038e000
         CPU: 0
       STATE: TASK_RUNNING (PANIC)

crash>
</pre>
</td>
</tr>
</table>
<p>This next example shows the output when the panicking kernel was <b><i>not</i></b>
built with <tt>-g</tt>.  In this case, a similar kernel type was built
with <tt>-g</tt>, and the resultant kernel object file was
renamed as <tt>vmlinux.dbg</tt>.  Note that there will be a message
concerning the patching of <tt>gdb</tt> data; this indicates that
the non-matching symbol values from the <tt>vmlinux.dbg</tt> are being
over-written by the correct symbol values found in the original <tt>vmlinux</tt> file:


</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>crash vmlinux vmlinux.dbg vmcore</b>

crash 4.0-8.11
Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007, 2008  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter "help copying" to see the conditions.
This program has absolutely no warranty.  Enter "help warranty" for details.
 
GNU gdb 6.1
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu"...

<b>please wait... (patching 16053 gdb minimal_symbol values)

DEBUG KERNEL: vmlinux.dbg
    DUMPFILE: vmcore</b>
        CPUS: 1
        DATE: Wed Mar 27 11:02:31 2002
      UPTIME: 00:07:24
LOAD AVERAGE: 0.43, 0.42, 0.19
       TASKS: 68
    NODENAME: anderson.boston.redhat.com
     RELEASE: 2.4.9-26beta.48enterprise
     VERSION: #1 SMP Thu Mar 21 12:33:05 EST 2002
     MACHINE: i686  (501 Mhz)
      MEMORY: 128 MB
       PANIC: "Oops: 0002" (check log for details)
         PID: 1696
     COMMAND: "insmod"
        TASK: c74de000  
         CPU: 0
       STATE: TASK_RUNNING (PANIC)

crash> 
</pre>
</td>
</tr>

</table>
<p>Invocation on a live system looks essentially the same, except that
the <tt>DUMPFILE</tt> will be indicated as <tt>/dev/mem</tt>.  In the
following example, no arguments were entered, because the running 
RHEL3 kernel was found in the <tt>/boot</tt> directory, and its
associated debuginfo file in the <tt>/usr/lib/debug/boot</tt> directory.
The debuginfo file is listed next to the <tt>DEBUGINFO</tt> tag:
</p>

<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>crash</b>

crash 4.0-8.11
Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007, 2008  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter "help copying" to see the conditions.
This program has absolutely no warranty.  Enter "help warranty" for details.

GNU gdb 6.1
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu"...

      <b>KERNEL: /boot/vmlinux-2.4.21-4.ELhugemem
   DEBUGINFO: /usr/lib/debug/boot/vmlinux-2.4.21-4.ELhugemem.debug
    DUMPFILE: /dev/mem</b>
        CPUS: 2
        DATE: Thu Aug 21 11:24:38 2003
      UPTIME: 1 days, 23:14:11
LOAD AVERAGE: 0.14, 0.10, 0.08
       TASKS: 106
    NODENAME: crash.boston.redhat.com
     RELEASE: 2.4.21-4.ELhugemem
     VERSION: #1 SMP Wed Aug 13 21:33:31 EDT 2003
     MACHINE: i686  (1993 Mhz)
      MEMORY: 511.5 MB
         PID: 4757
     COMMAND: "crash"
        TASK: 19b82000
         CPU: 1
       STATE: TASK_RUNNING (ACTIVE)

crash>
</pre>
</td>
</tr>
</table>

<h4>Invocation Errors</h4>
<p>Invocation errors will cause the <tt>crash</tt> session to abort upon
initialization.  Typically they occur as the result of one of the following 
reasons:
<ol>
<li>The <tt>vmlinux</tt> file contains no debug data (i.e., was built
without the <tt>-g</tt> flag), and no additional debug kernel object file
name was entered on the command line.  The error message will be of
the form:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">

<tr>
<td>
<pre>
crash: /boot/vmlinux-2.4.18-14: no debugging data available
</pre>
</td>
</tr>
</table>

</li>
<li>The <tt>vmlinux</tt> file does not match the dumpfile.  The error
message will be of the form:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>

<td>
<pre>
crash: vmlinux and tmp/vmcore do not match!
</pre>
</td>
</tr>
</table>

</li>
<li>The <tt>vmlinux</tt> file could not be found on a live system.
The error message will be of the form:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>

<pre>
crash: cannot find booted kernel -- please enter namelist argument
</pre>
</td>
</tr>
</table>
</li>
<li>
The associated debuginfo file cannot be found.
The error message will be of the form:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash: /boot/vmlinux-2.4.21-4.ELsmp: no debugging data available
crash: vmlinux-2.4.21-4.ELsmp.debug: debuginfo file not found
</pre>
</td>

</tr>
</table>
</li>

<li>
The <tt>crash</tt> utility binary does not match
the <tt>vmlinux</tt> and/or <tt>vmcore</tt> arguments.
The error message will be of the form:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">

<tr>
<td>
<pre>

WARNING: machine type mismatch:
         crash utility: X86
         vmlinux: X86_64

crash: vmlinux: not a supported file format
</pre>
</td>
</tr>
</table>
</li>
</ol>
<br>







<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="COMMAND_LINE"></a> <hr> <p>







<p>
<h3>Command Input</h3>
<p>Upon a successful session invocation on a dump file or a live kernel, 
the <tt>crash></tt> prompt will appear.
Interactive <tt>crash</tt> commands are gathered using the GNU
<tt>readline</tt> library, taking advantage of its command line
history mechanism, and its <tt>vi</tt> or <tt>emacs</tt>

command line editing modes.  Commands may also be issued to <tt>crash</tt>
from a file.
</p>
<h4><a name="COMMAND_LINE_HISTORY">Command Line History</a></h4>
The command line history consists of a numbered list of previously-run
commands.  The full list of commands may be viewed by entering 
<tt>h</tt> at any time.  For example: </p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>h</b>

[1] bt -a
[2] ps
[3] foreach bt
[4] set 
[5] dis -rl c0221141
crash>
</pre>
</td>
</tr>
</table>
<p>Commands in the history list may be re-run in the following manners</p>
<ol>
<li>To re-run the <b><i>last</i></b> command executed, simply enter
<tt>r</tt> or <tt>!!</tt> and then ENTER.</li>

<li>Enter <tt>r</tt> followed by the appropriate history list number,
and then ENTER.</li>
<li>Enter <tt>r</tt> followed by a uniquely-identifying set of characters
from the beginning of the previously-entered command string, and
then ENTER.</li>
<li>Recycle back through the command history list using the up-arrow and
down-arrow keys until the desired command is re-displayed, and then
ENTER.</li>
<li>Recycle back through the command history list using the key-strokes
appropriate for the command line editing mode being used (<tt>vi</tt>
or <tt>emacs</tt>) until the desired command is re-displayed, and then ENTER.

</ol>
<h4><a name="COMMAND_LINE_EDITING">Command Line Editing</a></h4>
<p>
The command line editing mode may be set to either <tt>vi</tt> (the default)
or <tt>emacs</tt>.  The mode may set in the following manners, listed in
increasing order of precedence:
</p>
<ol>
<li>Do none of the following, in which case the default <tt>vi</tt>
editing mode will be used.
<li>Set the <tt>EDITOR</tt> environment variable to either <tt>vi</tt>

or <tt>emacs</tt>.</li>
<li>Create an entry in a <tt>.crashrc</tt> file in the user's 
<tt>$HOME</tt> directory.  The entry must be a line of one of
the following forms:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
set vi
set emacs 

</pre>
</td>
</tr>
</table>
<li>Create an entry in a <tt>.crashrc</tt> file be located in the current
directory, in the form shown in (3) above.</li>
<li>Use the <tt>-e</tt> command line option, as in:</tt>
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>

<td>
<pre>
# crash -e [vi | emacs] ...
</pre>
</td>
</tr>
</table>
</li>
</li>
</ol>
<p>
Given either editing mode, any previously entered command line can be
brought back by entering the mode-specific key-stroke(s), the command line
edited using the proper mode, and then run by hitting ENTER.
</p>
<h4><a name="COMMAND_LINE_FROM_FILE">Command Line Input from a File </a></h4>
<p>An input file consisting of a list of commands may be fed to <tt>crash</tt>

in the following manners:
<ol>
<li>Upon invocation, as in: 
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# crash -i inputfile
</pre>
</td>
</tr>
</table>
</li>
<li>Upon invocation, by entering the commands in a <tt>.crashrc</tt> file,
which can be either in the user's <tt>$HOME</tt> directory or in the
current directory. </li>

<li>On the command line during a <tt>crash</tt> session, as in: </li>
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> < inputfile
</pre>
</td>
</tr>
</table>
</ol>

<p>In all of the three cases above, after the list of commands in the
file have completed, the <tt>crash></tt> prompt will appear and
commands may then be entered interactively (unless one of the
file commands happens to be the <tt>exit</tt> command).
</p>
<h4><a name="COMMAND_LINE_NUMBERS">Numerical Arguments</a></h4>
<p>
Numerical arguments are typically presumed to be decimal unless the argument contains
an <tt>a</tt>, <tt>b</tt>, <tt>c</tt>, <tt>d</tt>, <tt>e</tt> or <tt>f</tt>.
In those cases, the preceding <tt>0x</tt> is <b><i>not</i></b> required.  For
hexadecimal numbers that do not contain one of those 6 characters,
the preceding <tt>0x</tt> is required.  So, for example, a value of 1 gigabyte
would have to be expressed as <tt>0x40000000</tt>, whereas 3 gigabytes
could be expressed as <tt>c0000000</tt>.</p>

<p>It should be noted that several commands will <b><i>only</i></b> accept 
hexadecimal numerical arguments.  For example, the 
<a href="help_pages/rd.html"><tt>rd</tt></a> ("read") 
command only accepts hexadecimal addresses.  Therefore a read
from user address of 0x40017000 could be entered as:</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>rd 40017000 40</b>
40017000:  20000824 00000010 00000048 00000063   $.. ....H...c...
40017010:  00000082 000000ba 000000bb 000000cd   ................
40017020:  000000ce 000000cf 000000d7 000000db   ................
40017030:  000000dc 000000dd 000000de 000000e2   ................
40017040:  000000ed 00000167 6c676e45 20687369   ....g...English
40017050:  61636f6c 6620656c 7420726f 55206568   locale for the U
40017060:  46004153 20656572 74666f53 65726177   SA.Free Software
40017070:  756f4620 7461646e 2c6e6f69 636e4920    Foundation, Inc
40017080:  3935002e 6d655420 20656c70 63616c50   ..59 Temple Plac
40017090:  202d2065 74697553 33332065 42202c30   e - Suite 330, B
</pre>

</td>
</tr>
</table>
<p><br></p>






<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="COMMAND_OUTPUT"></a> <hr> <p>






<h3>Command Output</h3>
<p><tt>crash</tt> commands can often be verbose, and it's helpful
to control the output, as well as to be able to scroll backwards to
view previous command output. 
So, by default, command output that would overflow the user's
display screen is piped to <tt>/usr/bin/less</tt>, 
along with a prompt line that informs the user how to scroll forward, 
backward, or to quit the command.  For example, here is an example
of what a <a href="help_pages/ps.html"><tt>ps</tt></a> command might look like:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%" cellspacing="0">
<tr>
<td>

<pre>
crash> <b>ps</b>
   PID    PPID  CPU   TASK    ST  %MEM   VSZ   RSS  COMM
      0      0   0  c030a000  RU   0.0     0     0  [swapper]
      1      0   0  cff98000  IN   0.2  1412   468  init
      2      1   0  c1446000  IN   0.0     0     0  [keventd]
      3      1   0  cfffa000  IN   0.0     0     0  [kapm-idled]
      4      0   0  cfff8000  IN   0.0     0     0  [ksoftirqd_CPU0]
      5      0   0  cffee000  IN   0.0     0     0  [kswapd]
      6      0   0  cffec000  IN   0.0     0     0  [kreclaimd]
      7      0   0  c1826000  IN   0.0     0     0  [bdflush]
      8      0   0  c1824000  IN   0.0     0     0  [kupdated]
      9      1   0  cff90000  IN   0.0     0     0  [mdrecoveryd]
     13      1   0  cf07a000  IN   0.0     0     0  [kjournald]
     89      1   0  ce804000  IN   0.0     0     0  [khubd]
    184      1   0  ce4d4000  IN   0.0     0     0  [kjournald]
    572      1   0  cd938000  IN   0.0   440    48  dhcpcd
    637      1   0  ce4a4000  IN   0.2  1476   612  syslogd
    642      1   0  cd92c000  IN   0.2  2092   432  klogd
    663      1   0  ce2bc000  IN   0.2  1564   612  portmap
    691      1   0  cd84a000  IN   0.3  1652   668  rpc.statd
    803      1   0  cd756000  IN   0.2  1400   452  apmd
    828      1   0  cd6c2000  IN   0.3 18024   684  ypbind
    830    828   0  cd76e000  IN   0.3 18024   684  ypbind
    831    830   0  cd71c000  IN   0.3 18024   684  ypbind</pre></td>
</tr>
<tr>
<td bgcolor="#000000"><pre><FONT color="#FFFFFF"><b>-- MORE --  forward: &lt;SPACE&gt;, &lt;ENTER&gt; or j  backward: b or k  quit: q</b></pre>
</td>

</tr>
</table>
<p>This default output scrolling behavior can be turned off by entering
the following line in a <tt>.crashrc</tt> file located in either 
the <tt>$HOME</tt> or current directories:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
set scroll off
</pre>
</td>

</tr>
</table>
<p>
During runtime, the following commands (or their respective builtin aliases) can be used
to turn the scrolling behavior off, and back on, again:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>set scroll off</b>
scroll: off
crash> <b>set scroll on</b>
scroll: on
crash> <b>alias</b>

ORIGIN   ALIAS    COMMAND
builtin  man      help 
builtin  ?        help 
builtin  quit     q 
<b>builtin  sf       set scroll off
builtin  sn       set scroll on</b>
builtin  hex      set radix 16 
builtin  dec      set radix 10 
builtin  g        gdb 
builtin  px       p -x 
builtin  pd       p -d 
builtin  for      foreach 
builtin  size     * 
builtin  dmesg    log
builtin  last     ps -l
crash> <b>sf</b>
scroll: off
crash> <b>sn</b>
scroll: on
crash>
</pre>
</td>
</tr>
</table>
<a name="REDIRECT_OUTPUT"> </a>
<p>Alternatively, command output may be redirected to a pipe or to
a file using standard shell redirection syntax.  For examples:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> task | grep uid
  uid = 3369, 
  euid = 3369, 
  suid = 3369, 
  fsuid = 3369,
crash> foreach bt > bt.all
crash> ps >> process.data
crash> kmem -i | grep SLAB > slab.pages
crash>
</pre>
</td>
</tr>
</table>
<p>When a command's output is redirected to a pipe or file, 
the default <tt>/usr/bin/less</tt> behavior is turned off for that 
particular command.</p>
<h4><a name="NEW_PAGE">Numerical Output</a></h4>

<p>The default numerical output radix for non-pointer values is decimal,
which is most often noticed when using the builtin <tt>gdb</tt> capability of
printing formatted data structures.
During runtime, the following commands (or their respective builtin aliases) 
can be used to toggle the output radix from decimal to hexadecimal, and back
again:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>set radix 16</b>
output radix: 16 (hex)
crash> <b>set scroll 10</b>
output radix: 10 (decimal)
crash> <b>alias</b>

ORIGIN   ALIAS    COMMAND
builtin  man      help 
builtin  ?        help 
builtin  quit     q 
builtin  sf       set scroll off
builtin  sn       set scroll on
<b>builtin  hex      set radix 16 
builtin  dec      set radix 10</b>
builtin  g        gdb 
builtin  px       p -x 
builtin  pd       p -d 
builtin  for      foreach 
builtin  size     * 
builtin  dmesg    log
crash> <b>hex</b>
output radix: 16 (hex)
crash> <b>dec</b>
output radix: 10 (decimal)
crash>
</pre>
</td>
</tr>
</table>
<p>
Alternatively, the <tt>px</tt> or <tt>pd</tt> aliases 
coerce the "print" command <a href="help_pages/p.html"><tt>p</tt></a>,
to override the current output radix.
For example, here the changing value of <tt>jiffies</tt> on a live system
is printed using
the current default radix, then in hexadecimal, and lastly in decimal:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>p jiffies</b>
jiffies = $4 = 69821055
crash> <b>px jiffies</b>
jiffies = $5 = 0x42963aa
crash> <b>pd jiffies</b>
jiffies = $6 = 69821656
crash>
</pre>
</td>

</tr>
</table>
<p><br></p>





<p><br>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="CRASH_CONTEXT"></a> <hr> <p>




<p>
<h3>Crash Context</h3>
<p>Upon a successful invocation of a <tt>crash</tt> session, one of the
existing Linux tasks is selected as the <b><i>current context</i></b>.
It is important to be aware of the current context because several
<tt>crash</tt> commands are "context-sensitive", meaning that the
command is executed from the view-point of the current context.
Therefore, the output of context-sensitive commands can vary depending upon 
which context is current.
<p>
Upon invocation of a <tt>crash</tt> session, the selection of the 
current context is based upon the following criteria:

<p>
On dumpfiles:
<ul>
<li>The task that was running when <tt>die()</tt> was called.</li>
<li>The task that was running when <tt>panic()</tt> was called.</li>
<li>The task that was running when an 
ALT-SYSRQ-c keyboard interrupt was received.
<li>The task that was running when the character "c"
was echoed to <tt>/proc/sysrq-trigger</tt>.

</ul>
<p>
On a live system:
<ul>
<li>the <tt>crash</tt> task itself.</li>
</ul>
<p>The current context selection is shown in the session
invocation data.  For example, here is a session begun on a
dumpfile that was created when an <tt>insmod</tt> task's 
attempt to install a module resulted in an "oops" violation:</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>

<td>
<pre>
# <b>crash tmp/vm*</b>

crash 4.0-8.11
Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007, 2008  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter "help copying" to see the conditions.
This program has absolutely no warranty.  Enter "help warranty" for details.

GNU gdb 6.1
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu"...

      KERNEL: tmp/vmlinux
DEBUG KERNEL: tmp/vmlinux.dbg
    DUMPFILE: tmp/vmcore
        CPUS: 1
        DATE: Wed Mar 27 11:02:31 2002
      UPTIME: 00:07:24
LOAD AVERAGE: 0.43, 0.42, 0.19
       TASKS: 68
    NODENAME: anderson.boston.redhat.com
     RELEASE: 2.4.9-26beta.48enterprise
     VERSION: #1 SMP Thu Mar 21 12:33:05 EST 2002
     MACHINE: i686  (501 Mhz)
      MEMORY: 128 MB
       PANIC: "Oops: 0002" (check log for details)
         <b>PID: 1696
     COMMAND: "insmod"
        TASK: c74de000
         CPU: 0
       STATE: TASK_RUNNING (PANIC)</b>

crash>
</pre>
</td>
</tr>
</table>
<p>During runtime, the current context can always be displayed by entering
the <a href="help_pages/set.html"><tt>set</tt></a> 

command with no arguments:</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>set</b>
    PID: 1696
COMMAND: "insmod"
   TASK: c74de000
    CPU: 0
  STATE: TASK_RUNNING (PANIC)
crash>
</pre>
</td>
</tr>
</table>
<h4><a name="CRASH_CONTEXT_CHANGE">Changing the Crash Context</a></h4>

<p>The current context can be changed to a new task 
via the 
<a href="help_pages/set.html"><tt>set</tt></a> 
command.  Either of two "handles" may be used
to identify a task, the PID number, or the kernel address of the
task's <tt>task_struct</tt>.  For example:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>set 1</b>
    PID: 1
COMMAND: "init"
   TASK: c7f98000
    CPU: 0
  STATE: TASK_RUNNING
crash> <b>set c0a52000</b>

    PID: 1503
COMMAND: "cat"
   TASK: c0a52000
    CPU: 0
  STATE: TASK_INTERRUPTIBLE
crash>
</pre>
</td>
</tr>
</table>
<p>
Alternatively, the current context can be set to the task running
on a given CPU number, or back to the
panicking task.  Using the same dumpfile session shown above,
in which there is only one CPU, the original context may be restored
using the <tt>-c <i>CPU-number</i></tt> or the <tt>-p</tt>
("panic task") options:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">

<tr>
<td>
<pre>
crash> <b>set -c 0</b>
    PID: 1696
COMMAND: "insmod"
   TASK: c74de000
    CPU: 0
  STATE: TASK_RUNNING (PANIC)
crash> <b>set -p</b>
    PID: 1696
COMMAND: "insmod"
   TASK: c74de000
    CPU: 0
  STATE: TASK_RUNNING (PANIC)
crash>
</pre>
</td>
</tr>
</table>
<h4><a name="CRASH_CONTEXT_MEANING">Context-Sensitive Commands</a></h4>

It is important to be aware that several <tt>crash</tt> commands are 
context-sensitive.  For example, the
<a href="help_pages/files.html"><tt>files</tt></a>
command displays data about the open files of a task.
If it is issued with no arguments, it displays the open files data of
the current context.  In this example, the current context happens
to be PID 642, the <tt>klogd</tt> daemon:</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>files</b>

PID: 642    TASK: cd92c000  CPU: 0   COMMAND: "klogd"
ROOT: /    CWD: /
 FD    FILE     DENTRY    INODE    TYPE  PATH
  0  ce06c800  ce29ec60  cd8df900  REG   /proc/kmsg
  1  ce06cf20  ce29ebe0  cd8df740  SOCK  socket:/[858]
  2  ce06c5c0  ce2423a0  ce462c80  REG   /boot/System.map-2.4.9-e.3enterprise
</pre>
</td>
</tr>
</table>
<p>However, if the 
<a href="help_pages/files.html"><tt>files</tt></a>
command is issued with either of the two 
task handles as an argument, then it will display the open files data of 
the specified task. In this example, PID 12731 is specified:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>files 12731</b>

PID: 12731  TASK: c8150000  CPU: 0   COMMAND: "vi"
ROOT: /    CWD: /tmp
 FD    FILE     DENTRY    INODE    TYPE  PATH
  0  c988cd80  ced919a0  c87fc3c0  CHR   /dev/pts/11
  1  c988cd80  ced919a0  c87fc3c0  CHR   /dev/pts/11
  2  c988cd80  ced919a0  c87fc3c0  CHR   /dev/pts/11
  4  c2927ae0  c6cad8a0  cd6d5040  REG   /tmp/.crontab.12730.swp
  5  c2927a80  c6cad9a0  c5764ac0  REG   /tmp/crontab.12730
</pre>
</td>
</tr>
</table>
<p>This type of context-sensitive behaviour is also exhibited by the 
<a href="help_pages/vm.html"><tt>vm</tt></a>, 
<a href="help_pages/bt.html"><tt>bt</tt></a>, 
<a href="help_pages/sig.html"><tt>sig</tt></a>, 
<a href="help_pages/set.html"><tt>set</tt></a>, 
<a href="help_pages/net.html"><tt>net</tt></a> 
and 

<a href="help_pages/task.html"><tt>task</tt></a> commands.
Unless a PID or task address is specified as an argument, the output
will reflect data concerning the current context.
<p>Other commands may simply default to the current context.  For example,
the <a href="help_pages/rd.html"><tt>rd</tt></a> command can read memory from an address that is specified 
as a user-space address.  Since the <a href="help_pages/rd.html"><tt>rd</tt></a> command does not accept
a PID or task address as an argument, it would be necessary to be aware 
that the 
user-space access will come from the address space of the current context.
</p>
<p><br></p>





<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="HELP"></a> <hr> <p>




<p>
<h3>Builtin Help</h3>
<p>Readily available help information is built into the <tt>crash</tt> utility.  During a session,
entering the 
<a href="help_pages/help.html"><tt>help</tt></a> 
command with no argument shows the following menu:  
</p>

<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>

<td>
<!-- This table-within-a-table was created with help_menu.pl script -->
<TABLE>
<TR>
<TD WIDTH=125><TT><B>crash> help</B></TT></TD>
</TR>
 <TR>
<TD COLSPAN=5 HEIGHT=10>
</TR>
<TR>
<TD WIDTH=125><A HREF="help_pages/pointer.html"><TT><B>*</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/files.html"><TT><B>files</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/mod.html"><TT><B>mod</B></TT></A></TD>

<TD WIDTH=125><A HREF="help_pages/runq.html"><TT><B>runq</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/union.html"><TT><B>union</B></TT></A></TD>
</TR>
<TR>
<TD WIDTH=125><A HREF="help_pages/alias.html"><TT><B>alias</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/foreach.html"><TT><B>foreach</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/mount.html"><TT><B>mount</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/search.html"><TT><B>search</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/vm.html"><TT><B>vm</B></TT></A></TD>
</TR>

<TR>
<TD WIDTH=125><A HREF="help_pages/ascii.html"><TT><B>ascii</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/fuser.html"><TT><B>fuser</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/net.html"><TT><B>net</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/set.html"><TT><B>set</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/vtop.html"><TT><B>vtop</B></TT></A></TD>
</TR>
<TR>
<TD WIDTH=125><A HREF="help_pages/bt.html"><TT><B>bt</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/gdb.html"><TT><B>gdb</B></TT></A></TD>

<TD WIDTH=125><A HREF="help_pages/p.html"><TT><B>p</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/sig.html"><TT><B>sig</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/waitq.html"><TT><B>waitq</B></TT></A></TD>
</TR>
<TR>
<TD WIDTH=125><A HREF="help_pages/btop.html"><TT><B>btop</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/help.html"><TT><B>help</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/ps.html"><TT><B>ps</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/struct.html"><TT><B>struct</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/whatis.html"><TT><B>whatis</B></TT></A></TD>

</TR>
<TR>
<TD WIDTH=125><A HREF="help_pages/dev.html"><TT><B>dev</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/irq.html"><TT><B>irq</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/pte.html"><TT><B>pte</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/swap.html"><TT><B>swap</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/wr.html"><TT><B>wr</B></TT></A></TD>
</TR>
<TR>
<TD WIDTH=125><A HREF="help_pages/dis.html"><TT><B>dis</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/kmem.html"><TT><B>kmem</B></TT></A></TD>

<TD WIDTH=125><A HREF="help_pages/ptob.html"><TT><B>ptob</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/sym.html"><TT><B>sym</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/q.html"><TT><B>q</B></TT></A></TD>
</TR>
<TR>
<TD WIDTH=125><A HREF="help_pages/eval.html"><TT><B>eval</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/list.html"><TT><B>list</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/ptov.html"><TT><B>ptov</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/sys.html"><TT><B>sys</B></TT></A></TD>
</TR>

<TR>
<TD WIDTH=125><A HREF="help_pages/exit.html"><TT><B>exit</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/log.html"><TT><B>log</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/rd.html"><TT><B>rd</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/task.html"><TT><B>task</B></TT></A></TD>
</TR>
<TR>
<TD WIDTH=125><A HREF="help_pages/extend.html"><TT><B>extend</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/mach.html"><TT><B>mach</B></TT></A></TD>
<TD WIDTH=125><A HREF="help_pages/repeat.html"><TT><B>repeat</B></TT></A></TD>

<TD WIDTH=125><A HREF="help_pages/timer.html"><TT><B>timer</B></TT></A></TD>
</TR>
<TR>
<TD COLSPAN=5>
</TD>
</TR>
<TR>
<TD COLSPAN=5>
<PRE><TT><B>
crash version: 4.0-8.11   gdb version: 6.1
For help on any command above, enter "help &lt;command&gt;".
For help on input options, enter "<A HREF="help_pages/input.html"><TT><B>help input</B></TT></A>".
For help on output options, enter "<A HREF="help_pages/output.html"><TT><B>help output</B></TT></A>".

crash>

</TD>
</TR>
</TABLE>
</td>
</tr>
</table>
<p>Each command has its own <tt>man</tt>-like help page, which can be
viewed by clicking on the command name above.  
Each help page details the syntax of the command and its available options,
a description of the command in general, a description of each option,
and a set of examples.
During a <tt>crash</tt>
session, a command's help page can be displayed by entering
<a href="help_pages/help.html"><tt>help</tt></a>
followed by the command name.  
So, for example, to get help on how to use the 
<a href="help_pages/set.html"><tt>set</tt></a>

command:</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>help set</b>

NAME
  set - set a process context or internal crash variable

SYNOPSIS
  set [pid | taskp | [-c cpu] | -p] | [crash_variable [setting]] | -v

DESCRIPTION
  This command either sets a new context, or gets the current context for
  display.  The context can be set by the use of:

      pid  a process PID.
    taskp  a hexadecimal task_struct pointer.
   -c cpu  sets the context to the active task on a cpu (dumpfiles only).
       -p  sets the context to the panic task, or back to the crash task on
           a live system.
       -v  display the current state of internal crash variables.

  If no argument is entered, the current context is displayed.  The context
  consists of the PID, the task pointer, the CPU, and task state.
  
  This command may also be used to set internal crash variables.  If no value
  argument is entered, the current value of the crash variable is shown.  These
  are the crash variables, acceptable arguments, and purpose:

          scroll  on | off     controls output scrolling.
          scroll  less         /usr/bin/less as the output scrolling program.
          scroll  more         /bin/more as the output scrolling program.
          scroll  CRASHPAGER   use CRASHPAGER environment variable as the
                               output scrolling program.
           radix  10 | 16      sets output radix to 10 or 16.
         refresh  on | off     controls internal task list refresh.
       print_max  number       set maximum number of array elements to print.
         console  device-name  sets debug console device.
           debug  number       sets crash debug level.
            core  on | off     if on, drops core when the next error message
                               is displayed.
            hash  on | off     controls internal list verification.
          silent  on | off     turns off initialization messages; turns off
                               crash prompt during input file execution. 
                               (scrolling is turned off if silent is on)
            edit  vi | emacs   set line editing mode (from .crashrc file only).
        namelist  filename     name of kernel (from .crashrc file only).
        dumpfile  filename     name of core dumpfile (from .crashrc file only).
   zero_excluded  on | off     controls whether excluded pages from a dumpfile
                               should return zero-filled memory.
 
  Internal variables may be set in four manners:

    1. entering the set command in $HOME/.crashrc.
    2. entering the set command in .crashrc in the current directory.
    3. executing an input file containing the set command.
    4. during runtime with this command.

  During initialization, $HOME/.crashrc is read first, followed by the
  .crashrc file in the current directory.  Set commands in the .crashrc file
  in the current directory override those in $HOME/.crashrc.  Set commands 
  entered with this command or by runtime input file override those
  defined in either .crashrc file.  Multiple set command arguments or argument
  pairs may be entered in one command line.

EXAMPLES
  Set the current context to task c2fe8000:

    crash&gt; set c2fe8000
         PID: 15917
     COMMAND: "bash"
        TASK: c2fe8000  
         CPU: 0
       STATE: TASK_INTERRUPTIBLE

  Set the context back to the panicking task:

    crash&gt; set -p
         PID: 698
     COMMAND: "gen12"
        TASK: f9d78000
         CPU: 2
       STATE: TASK_RUNNING (PANIC)

  Turn off output scrolling:

    crash&gt; set scroll off
    scroll: off (/usr/bin/less)
 
  Show the current state of crash internal variables:

    crash&gt; set -v
            scroll: on (/usr/bin/less)
             radix: 10 (decimal)
           refresh: on
         print_max: 256
           console: /dev/pts/2
             debug: 0
              core: off
              hash: on
            silent: off
              edit: vi
          namelist: vmlinux
          dumpfile: vmcore
     zero_excluded: off
 
  Show the current context:

    crash&gt; set
         PID: 1525
     COMMAND: "bash"
        TASK: c1ede000
         CPU: 0
       STATE: TASK_INTERRUPTIBLE

</pre>
</td>
</tr>
</table>
<p>If for some reason a <tt>crash</tt> session cannot be invoked, but
help information for a particular <tt>crash</tt> command is desired, the same
help page can be displayed from a shell command line using the
<tt>-h</tt> option to <tt>crash</tt>:</p>

<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>crash -h ascii</b>

NAME
  ascii - translate a hexadecimal string to ASCII

SYNOPSIS
  ascii value ...

DESCRIPTION
  Translates 32-bit or 64-bit hexadecimal values to ASCII.  If no argument
  is entered, an ASCII chart is displayed.

EXAMPLES
  Translate the hexadecimal value of 0x62696c2f7273752f to ASCII:

    crash> ascii 62696c2f7273752f
    62696c2f7273752f: /usr/lib

  Display an ASCII chart:

    crash> ascii
 
          0    1   2   3   4   5   6   7
        +-------------------------------
      0 | NUL DLE  SP  0   @   P   '   p
      1 | SOH DC1  !   1   A   Q   a   q
      2 | STX DC2  "   2   B   R   b   r
      3 | ETX DC3  #   3   C   S   c   s
      4 | EOT DC4  $   4   D   T   d   t
      5 | ENQ NAK  %   5   E   U   e   u
      6 | ACK SYN  &   6   F   V   f   v
      7 | BEL ETB  `   7   G   W   g   w
      8 |  BS CAN  (   8   H   X   h   x
      9 |  HT  EM  )   9   I   Y   i   y
      A |  LF SUB  *   :   J   Z   j   z
      B |  VT ESC  +   ;   K   [   k   {
      C |  FF  FS  ,   <   L   \   l   |
      D |  CR  GS  _   =   M   ]   m   }
      E |  SO  RS  .   >   N   ^   n   ~
      F |  SI  US  /   ?   O   -   o  DEL

#
</pre>
</td>
</tr>
</table>
<p>Lastly, help concerning command input and output can be displayed
by entering 

<A HREF="help_pages/input.html"><TT><B>help input</B></TT></A>
or 
<A HREF="help_pages/output.html"><TT><B>help output</B></TT></A>
during runtime,
or <tt>crash -h input</tt> or <tt>crash -h output</tt> from a shell
command line.</p>
<p><br></p>




<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="COMMAND_SET"></a> <hr> <p>




<p>
<h3>The Command Set</h3>
<p>Each <tt>crash</tt> command generally falls into one of the
following categories:</p>
<ul>
<li><b><a href="#SYMBOLIC_DISPLAY">Symbolic display of kernel text or data</a></li>
<li><a href="#SYSTEM_STATE">System state</a></li>
<li><a href="#UTILITY_FUNCTIONS">Utility functions</a></li>

<li><a href="#CONTROL_COMMANDS">Session Control Commands</a></b></li>
</ul>
<p>
The remainder
of this section breaks the command set into categories, and gives a short
description of each command in that category.
However, for complete details and examples, 
recall that the <tt>crash</tt> utility has a
self-contained help page for each command; to view the full help page,
click on the command name next to its description below.
</p>
<a name="SYMBOLIC_DISPLAY"><hr></a>
<h4>Symbolic Display of Kernel Text or Data</h4>
<p>The following commands typically take full advantage of the power 
of <tt>gdb</tt> to display kernel data structures symbolically.

<table cellspacing="10" border="0" width="100%">

<tr>
<td>
<b><u>Command</u></b></td>
<td><pre> </pre></td>
<td align="center">
<b><u>Description</u></b>
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/struct.html">
<tt><b>struct</b></tt></a></td>

<td><pre> </pre></td>
<td valign="top">
Displays a formatted kernel data structure type located at a 
given address, or at an address referred to by a symbol; if no address
is specified, the structure definition is displayed.  The output can
be narrowed down to a singular member of the structure, or
to display the offset of every member from the beginning
of the structure. A count may be appended to display an array of structures.
Its usage is so common that two short-cuts exist such that the user
need not enter the "<tt>struct</tt>" command name: 
<ol>
<li>The "pointer-to" <tt>*</tt> command below can be substituted.</li>
<li>If a structure name is entered as the first token on a command line,
the "<tt>struct</tt>" command is actually not necessary.</li>
</li>

</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/union.html">
<tt><b>union</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Same as <tt>struct</tt> command, but used for kernel data types 
defined as unions instead of structures..
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/pointer.html">
<tt><b>*</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
"Pointer-to" command which can be used in lieu of entering <tt>struct</tt>
or <tt>union</tt>; the <tt>gdb</tt> module first determines whether the 
argument is a structure or a union, and then calls the appropriate function.
</td>

</tr>

<tr>
<td valign="top"><a href="help_pages/p.html">
<tt><b>p</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Displays the contents of a kernel variable; the arguments
are passed on to <tt>gdb</tt>'s <tt>print</tt> command for proper formatting.
Two builtin aliases, <tt>px</tt> and <tt>pd</tt>, set the numerical
output radix to hexadecimal or decimal for the print operation, temporarily
overriding the current default.

</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/whatis.html">
<tt><b>whatis</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Displays all available symbol table information concerning a data type
or a data symbol.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/sym.html">
<tt><b>sym</b></tt></a></td>

<td><pre> </pre></td>
<td valign="top">
Translates a kernel symbol name to its kernel virtual address and section,
or a kernel virtual address to its symbol name and section.  It can also
be used to dump the complete list of kernel symbols, or to query the symbol
list for all symbols containing a given sub-string.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/dis.html">
<tt><b>dis</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Disassembles the text of complete kernel function, or from a specified 
address for a given number of instructions, or from the beginning of a
function up to a specified address.
</td>
</tr>

</table>
<a name="SYSTEM_STATE"><hr></a>
<h4>System State</h4>

<p>The majority of <tt>crash</tt> commands come from the following set of
"kernel-aware" commands, which delve into various kernel subsystems on
a system-wide or per-task basis.  The task-specific commands are 
context-sensitive, meaning that they act upon the current context unless
a PID or task address is specified as an argument.

<table cellspacing="10" border="0" width="100%">

<tr>
<td>
<b><u>Command</u></b></td>
<td><pre> </pre></td>

<td align="center">
<b><u>Description</u></b>
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/bt.html">
<tt><b>bt</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Arguably the most useful <tt>crash</tt> command, <tt>bt</tt> displays a 
task's kernel stack 
back-trace, including full exception frame dumps.  It is context-sensitive,
although the <tt>-a</tt> option will display the stack
traces of the active task on each CPU.  This command is often used within
the <a href="help_pages/foreach.html"><tt>foreach</tt></a> wrapper command
in order to display the back traces of all tasks with one command.

</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/dev.html">
<tt><b>dev</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Displays data concerning the character and block device assignments,
I/O port usage, I/O memory usage, and PCI device data.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/files.html">
<tt><b>files</b></tt></a></td>

<td><pre> </pre></td>
<td valign="top">
This context-sensitive command displays the task's current root directory 
and working directories, and then for each open file descriptor, shows:
<ul>
<li type="circle">its <tt>file</tt> struct address</li>
<li type="circle">its <tt>dentry</tt> struct address</li>
<li type="circle">its <tt>inode</tt> struct address</li>

<li type="circle">the file type</li>
<li type="circle">the file's full pathname</li>
</ul>
Another option acts upon a specified <tt>dentry</tt> address, showing:
<ul>
<li type="circle">its <tt>inode</tt> struct address</li>
<li type="circle">its <tt>superblock</tt> struct address</li>

<li type="circle">the file type</li>
<li type="circle">the file's full pathname</li>
</ul>
It can be called from the
<a href="help_pages/foreach.html"><tt>foreach</tt></a> wrapper command.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/fuser.html">
<tt><b>fuser</b></tt></a></td>
<td><pre> </pre></td>

<td valign="top">
Displays a list of tasks that reference a specified filename 
or <tt>inode</tt> address as the current root or working directory, 
an open file descriptor, or which mmap the file.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/irq.html">
<tt><b>irq</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Display data concerning interrupt request numbers and bottom-half handling.
</td>

</tr>

<tr>
<td valign="top"><a href="help_pages/kmem.html">
<tt><b>kmem</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
This command has numerous options that delve into the state of
several kernel memory subsystems:
<ul>
<li type="circle">general memory usage, similar in scope to <tt>/proc/meminfo</tt></li>
<li type="circle"><tt>kmalloc</tt> slab memory allocator, including an option
that lists each slab object and its state, verifying the slab chain</li>

<li type="circle">display and verification of free page lists</li>
<li type="circle"><tt>vmalloc</tt> memory allocator <tt>vmlist</tt> contents</li>
<li type="circle">display and verification of the page cache</li>
<li type="circle">the <tt>mem_map</tt> page list</li>
<li type="circle">display NUMA data, if applicable</li>

</ul>
Also, given an address, this command searches the symbol table,
the slab subsystem, the free list, the <tt>page_hash_table</tt>,
the <tt>vmlist</tt>, and the <tt>mem_map</tt> array,
displaying where it was found.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/log.html">
<tt><b>log</b></tt></a></td>
<td><pre> </pre></td>

<td valign="top">
Dumps the kernel message buffer chronologically, accounting for
any wrap-around.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/mach.html">
<tt><b>mach</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Displays machine and/or processor specific data.
</td>
</tr>

<tr>

<td valign="top"><a href="help_pages/mod.html">
<tt><b>mod</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Displays the list of currently-loaded kernel modules.  More importantly,
it loads the debug data from the module object files if they are
available, allowing symbolic debugging capability
of kernel modules.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/mount.html">
<tt><b>mount</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">

For each mounted filesystem, or for just a specified filesystem, displays:
<ul>
<li type="circle">its <tt>vfsmount</tt> struct address</li>
<li type="circle">its <tt>super_block</tt> struct address</li>
<li type="circle">its type</li>
<li type="circle">its device name</li>
<li type="circle">its mount point</li>

</ul>
Options exist to dump a list of a specified filesystem's open files or dirty inodes.  Filesystems may be specified by
<tt>vfsmount</tt>, <tt>super_block</tt>, or <tt>inode</tt> addresses, or
by device name or mount point names.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/net.html">
<tt><b>net</b></tt></a></td>
<td><pre> </pre></td>

<td valign="top">
Displays various network-related data:
<ul>
<li type="circle">displays each configured network 
device's <tt>net_device</tt> address, its name, and IP address</li>
<li type="circle">displays the ARP cache</li>
<li type="circle">context-sensitive display of information concerning the open sockets 
of a task</li>
<li type="circle">translates an IP address expressed as a decimal or 
hexadecimal 
value into a standard numbers-and-dots notation</li>
</ul>
It can be called from the
<a href="help_pages/foreach.html"><tt>foreach</tt></a> wrapper command.

</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/ps.html">
<tt><b>ps</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Useful process status command, in typical Linux <tt>ps</tt> command 
type output, containing:
<ul>
<li type="circle">PID number</li>

<li type="circle">PPID number</li>
<li type="circle">CPU number</li>
<li type="circle">task address</li>
<li type="circle">process state</li>
<li type="circle">percent of physical memory consumed</li>
<li type="circle">virtual address size</li>
<li type="circle">resident set size</li>
<li type="circle">command name</li>
</ul>

Also has an option to show a task's parental hierarchy back to the
<tt>init</tt> process, and another to show all children of a task.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/pte.html">
<tt><b>pte</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
This command translates the contents of a PTE into its physical
page address and page bit settings, or if it references a swap location,
the swap device and offset.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/runq.html">
<tt><b>runq</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Displays list of tasks on the run queue.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/sig.html">
<tt><b>sig</b></tt></a></td>
<td><pre> </pre></td>

<td valign="top">
A context-sensitive command which displays a task's signal
information, including:
<ul>
<li type="circle"> 
whether an unblocked signal is pending</li>
<li type="circle">the pending and blocked signals</li>
<li type="circle">the handler data for each signal</li>
<li type="circle">queued signals, if any</li>
</ul>
Other options list the signal number/names combination for a processor type,
and translate the contents of a <tt>sigset_t</tt> into the signal names
whose bits are set.
It can be called from the

<a href="help_pages/foreach.html"><tt>foreach</tt></a> wrapper command.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/swap.html">
<tt><b>swap</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
For each configured swap device, this command displays
the same data that is shown by the Linux command <tt>swapon -s</tt>.
</td>

</tr>

<tr>
<td valign="top"><a href="help_pages/sys.html">
<tt><b>sys</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Re-displays the same system-related data that is seen during
<tt>crash</tt> initialization:
<ul>
<li type="circle">the kernel object filename</li>
<li type="circle">the dumpfile name</li>

<li type="circle">the number of CPUS</li>
<li type="circle">the date</li>
<li type="circle">system uptime</li>
<li type="circle">system load average</li>
<li type="circle">the number of tasks</li>
<li type="circle">the nodename</li>
<li type="circle">the kernel release and version data</li>
<li type="circle">the processor type and speed</li>
<li type="circle">the amount of memory</li>

<li type="circle">the panic string</li>
</ul>
Other options display information concerning the system call table,
and one allows the <tt>root</tt> user to panic a live system.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/task.html">
<tt><b>task</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">

This context-sensitive command displays a task's complete <tt>task_struct</tt>
contents, or one or more members of the structure.
This command is often used within the 
<a href="help_pages/foreach.html"><tt>foreach</tt></a> wrapper command
in order to display <tt>task_struct</tt> data for all tasks with one
command.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/timer.html">
<tt><b>timer</b></tt></a></td>

<td><pre> </pre></td>
<td valign="top">
Displays the timer queue entries in chronological order,
listing the target function names, the current value of <tt>jiffies</tt>,
and the expiration time of each entry.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/vm.html">
<tt><b>vm</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
This powerful, context-sensitive command displays a wealth of information
concerning a task's virtual memory data, including:

<ul>
<li type="circle">its <tt>mm_struct</tt> address</li>
<li type="circle">its page directory address</li>
<li type="circle">its resident set size</li>
<li type="circle">its total virtual memory size</li>
<li type="circle">each <tt>vm_area_struct</tt> address, along with 
its start and ending virtual
address, flags, and source file if applicable.</li>

<li type="circle">optionally, every virtual page referenced by a
<tt>vm_area_struct</tt> can be translated into its
physical address, or if not resident, its file and
offset.
</ul>
Other options translate the flags of a <tt>vm_area_struct</tt>,
or display the full contents of a task's <tt>mm_struct</tt>
or of each <tt>vm_area_struct</tt>.
It can be called from the
<a href="help_pages/foreach.html"><tt>foreach</tt></a> wrapper command.
</td>

</tr>

<tr>
<td valign="top"><a href="help_pages/vtop.html">
<tt><b>vtop</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
This context-sensitive command translates a user or kernel virtual address 
to its physical address.  Also displayed are:
<ul>
<li type="circle">the full PTE translation from page directory through to
the page table</li>
<li type="circle">the <tt>vm_area_struct</tt> data for user virtual addresses</li>

<li type="circle">the <tt>mem_map</tt> page data associated with the physical page</li>
<li type="circle">the swap location or file location if a user virtual page is not
currently mapped</li>
</ul>
It can be called from the 
<a href="help_pages/foreach.html"><tt>foreach</tt></a> wrapper command.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/waitq.html">

<tt><b>waitq</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Lists the tasks linked on a specified kernel wait queue.
</td>
</tr>


</table>
<a name="UTILITY_FUNCTIONS"><hr></a>
<h4>Utility Functions</h4>

<p>The following commands are a set of useful helper commands
serving various purposes, some simple, others quite powerful.

<table cellspacing="10" border="0" width="100%">

<tr>
<td>
<b><u>Command</u></b></td>
<td><pre> </pre></td>
<td align="center">
<b><u>Description</u></b>
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/ascii.html">
<tt><b>ascii</b></tt></a></td>

<td><pre> </pre></td>
<td valign="top">
Translates a numerical value into its ASCII components; with no arguments,
displays an ASCII chart.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/btop.html">
<tt><b>btop</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Translates a byte value (physical address) to its page number.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/eval.html">
<tt><b>eval</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
A simple calculator, evaluates an expression and displays the result
in hexadecimal, decimal, octal and binary, and optionally showing
the bit numbers set in the result.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/list.html">
<tt><b>list</b></tt></a></td>
<td><pre> </pre></td>

<td valign="top">
Dumps the entries of a linked list of structures.  
It can handle lists of structures that are
singly-linked with simple "next" pointers, or those with 
embedded <tt>list_head</tt>
structures.  The output may be constrained to simply display the address of each
structure in the list, or if directed, also dump each complete structure,
or just one member of each structure.  The gathered list entries are hashed,
so a corrupted list that loops back upon itself will be recognized.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/ptob.html">
<tt><b>ptob</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
translates a page frame number to its byte value (physical address).
</td>

</tr>

<tr>
<td valign="top"><a href="help_pages/ptov.html">
<tt><b>ptov</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Translates a physical address into a kernel virtual address by
adding the appropriate <tt>PAGE_OFFSET</tt> value.
</td>
</tr>

<tr>

<td valign="top"><a href="help_pages/search.html">
<tt><b>search</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Searches a range of user or kernel memory space for given value, with
an optional "don't care" bit-mask argument.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/rd.html">
<tt><b>rd</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">

Displays a specified amount of user virtual, kernel virtual, or physical memory
in several formats, such as 8, 16, 32 or 64 bit values, hexadecimal or
decimal, symbolically, and with ASCII translations.  When reading user
virtual addresses, the command is context-sensitive.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/wr.html">
<tt><b>wr</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Modifies the contents of memory on a live system.  Write permission
on <tt>/dev/mem</tt> is required; this command should obviously be used 
with great care.  The write operation is constrained to one 8, 16, 32 
or 64 bit location.
</td>
</tr>

</table>
<a name="CONTROL_COMMANDS"><hr></a>
<h4>Session Control Commands</h4>

<p>The following commands typcally aid in the efficient 
running of a <tt>crash</tt> session.

<table cellspacing="10" border="0" width="100%">

<tr>
<td>
<b><u>Command</u></b></td>
<td><pre> </pre></td>

<td align="center">
<b><u>Description</u></b>
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/alias.html">
<tt><b>alias</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Creates a single-word alias for a command string.  
Several aliases are built into
<tt>crash</tt>; user-defined aliases may also be defined in 
a <tt>.crashrc</tt> file, or during a <tt>crash</tt> session
by entering it on the command line or reading it from an input file.

</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/exit.html">
<tt><b>exit</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Shuts down the <tt>crash</tt> session (same as <a href="help_pages/q.html"><tt>q</tt></a>).
</td>

</tr>

<tr>
<td valign="top"><a href="help_pages/extend.html">
<tt><b>extend</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Extend the <tt>crash</tt> command set by
dynamically loading a shared object library containing one or more
user-written commands.
</td>
</tr>

<tr>

<td valign="top"><a href="help_pages/foreach.html">
<tt><b>foreach</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Quite often it is helpful, or even necessary, to run the same <tt>crash</tt>
context-sensitive command on a number of tasks by just entering one command.  
This wrapper command sets off the execution 
of a given <tt>crash</tt> command on each of a defined set of tasks,
temporarily changing the current context to that of the targeted task
before running the command.
The set of tasks that are issued the given command can be defined by:
<ul>
<li type="circle">one or more PID numbers</li>
<li type="circle">one or more task numbers</li>

<li type="circle">one or more command name</li>
<li type="circle">all user tasks</li>
<li type="circle">all kernel tasks</li>
<li type="circle">the active task on each CPU</li>
</ul>
The identifiers above may be mixed if it makes sense, such as using a 
combination of PIDs, task addresses, and command names.
The context-sensitive commands that can be issued to the selected tasks are:
<ul>
<li type="circle"><a href="help_pages/bt.html"><tt>bt</tt></a></li>
<li type="circle"><a href="help_pages/vm.html"><tt>vm</tt></a></li>
<li type="circle"><a href="help_pages/task.html"><tt>task</tt></a></li>

<li type="circle"><a href="help_pages/files.html"><tt>files</tt></a></li>
<li type="circle"><a href="help_pages/net.html"><tt>net</tt></a></li>
<li type="circle"><a href="help_pages/set.html"><tt>set</tt></a></li>
<li type="circle"><a href="help_pages/sig.html"><tt>sig</tt></a></li>
<li type="circle"><a href="help_pages/vtop.html"><tt>vtop</tt></a></li>
</ul>
A header containing the PID, task address, CPU and command name will be
pre-pended before the command output for each selected task.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/gdb.html">

<tt><b>gdb</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
This command passes its arguments directly to <tt>gdb</tt> for processing.
This is typically not necessary, but where ambiguities between <tt>crash</tt> 
and <tt>gdb</tt> command names exist, this will force the command to be 
executed by <tt>gdb</tt>.

</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/repeat.html">
<tt><b>repeat</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
This wrapper command repeats a <tt>crash</tt> command indefinitely, optionally 
delaying a given number of seconds between each command execution.
Obviously this command is only useful when running on a live system.
</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/set.html">
<tt><b>set</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
This primary purpose for this command is to set the <tt>crash</tt> context to
a new task, or to display the current context.  It can also be used to view or 
change one of a set of internal <tt>crash</tt> variables that modify program
behavior, such as the default output radix or scrolling behavior.
It can be called from the
<a href="help_pages/foreach.html"><tt>foreach</tt></a> wrapper command for
viewing the context data of each task.

</td>
</tr>

<tr>
<td valign="top"><a href="help_pages/q.html">
<tt><b>q</b></tt></a></td>
<td><pre> </pre></td>
<td valign="top">
Shuts down the <tt>crash</tt> session (same as 
<a href="help_pages/exit.html"><tt>exit</tt></a>).
</td>

</tr>

</table>





<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="EXAMPLES"></a> <hr> <p>




<p>
<h3>Crash Usage: A Case Study</h3>
<p>
The steps taken to debug a kernel crash dump are not 
etched in stone, and the <tt>crash</tt> commands used to debug a kernel issue 
vary according to the problem exhibited. 
The section contains of a <a href="#CASE_STUDY">case study</a> that shows how the
capabilities of the <tt>crash</tt> utility were used to to debug a 
specific kernel problem.
However, before doing so, it should be noted that the following commands are 
typically the most commonly-used:

<blockquote>
</p>
<table border="3" width="90%" cellpadding=8>
<tr>
<td align=center>
<a href="help_pages/bt.html"><tt>bt</tt></a>
</td>
<td>
Display the backtrace of the current context, or as specified with arguments.
This command is typically the first command entered after starting
a dumpfile session.  Since the initial context is the panic context, 
it will show the function trace leading up to the kernel panic.
<tt>bt -a</tt> will show the trace of the <i>active</i> task
on each CPU, since there may be an interrelationship between
the panicking task on one CPU and the running task(s) on the
other CPU(s).  When <tt>bt</tt> is given as the argument to 

<a href="help_pages/foreach.html"><tt>foreach</tt></a>.
displays the backtraces of <i>all</i> tasks.
</td>
</tr>

<tr>
<td>
<a href="help_pages/struct.html"><tt>struct</tt></a>
</td>
<td>
<a name="SHORT_CUT"></a>
Print the contents of a 
data structure at a specified address.
This command is so common that it is typically unnecessary to enter
the <tt>struct</tt> command name on the command line;
if the first command line argument
is not a <tt>crash</tt> or <tt>gdb</tt> command, but it

<i>is</i> the name of a known data structure, then all the 
command line arguments
are passed to the <tt>struct</tt> command.
So for example, the following two commands yield the same result:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> struct vm_area_struct d3cb2600
</pre>
</td>
</tr>
</table>
<br>

<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> vm_area_struct d3cb2600
</pre>
</td>
</tr>
</table>
</td>
</tr>

<tr>
<td align=center>
<a href="help_pages/set.html"><tt>set</tt></a>
</td>

<td>
Set a new task context by PID, task address, or cpu.
Since several <tt>crash</tt> commands are context-sensitive,
it's helpful to be able to change the context to avoid having
to pass the PID or task address to those context-sensitive commands
in order to access the data of a task that is <i>not</i> the current context.
</td>
</tr>

<tr>
<td align=center>
<a href="help_pages/p.html"><tt>p</tt></a>
</td>
<td>

Prints the contents of a kernel variable; since it's a gateway to the
<tt>print</tt> command of the
mbedded <tt>gdb</tt> module, it can also be used to print complex C language
expressions.
</td>
</tr>

<tr>
<td align=center>
<a href="help_pages/rd.html"><tt>rd</tt></a>
</td>
<td>
Read memory, which may be either kernel virtual, user virtual, or physical,
and display it several different formats and sizes. 

</td>
</tr>

<tr>
<td align=center>
<a href="help_pages/ps.html"><tt>ps</tt></a>
</td>
<td>
Lists basic task information for each process; it can also display
parent and child hierarchies.
</td>
</tr>

<tr>
<td align=center>
<a href="help_pages/log.html"><tt>log</tt></a>

</td>
<td>
Dump the kernel <tt>log_buf</tt>, which often contains clues leading up
to a subsequent kernel crash.
</td>
</tr>

<tr>
<td align=center>
<a href="help_pages/foreach.html"><tt>foreach</tt></a>
</td>
<td>
Execute a <tt>crash</tt> command on all tasks, or those specified, in the 
system; can be used with <a href="help_pages/bt.html"><tt>bt</tt></a>,

<a href="help_pages/vm.html"><tt>vm</tt></a>,
<a href="help_pages/task.html"><tt>task</tt></a>,
<a href="help_pages/files.html"><tt>files</tt></a>,
<a href="help_pages/net.html"><tt>net</tt></a>, 
<a href="help_pages/set.html"><tt>set</tt></a>,
<a href="help_pages/sig.html"><tt>sig</tt></a> and
<a href="help_pages/vtop.html"><tt>vtop</tt></a>.
</td>
</tr>

<tr>
<td align=center>
<a href="help_pages/files.html"><tt>files</tt></a>
</td>
<td>
Dump the open file descriptor data of a task; most usefully, the
<tt>file</tt>, <tt>dentry</tt> and <tt>inode</tt> structure
addresses for each open file descriptor.
</td>

</tr>

<tr>
<td align=center>
<a href="help_pages/vm.html"><tt>vm</tt></a>
</td>
<td>
Dump the virtual memory map of a task, including the vital information
concerning each <tt>vm_area_struct</tt> making up a task's address space.
It can also dump the physical address of each page in the address space, or if
not mapped, its location in a file or on the swap device.
</td>
</tr>

</table>
</blockquote>

</p>
<a name="CASE_STUDY"><hr></a>
<h4>A Case Study: <tt>"kernel BUG at pipe.c:120!"</tt></h4>
Upon bringing up a <tt>crash</tt> session, a
great deal of information can be gained just by the 
invocation data.  Here is what what displayed in this particular case:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
...
      KERNEL: vmlinux-2.4.9-e.10.13enterprise-g
    DUMPFILE: vmcore-incomplete
        CPUS: 2
        DATE: Mon Feb 17 08:20:56 2003
      UPTIME: 4 days, 20:04:41
LOAD AVERAGE: 0.95, 1.04, 1.25
       TASKS: 110
    NODENAME: testbox.redhat.com
     RELEASE: 2.4.9-e.10.13enterprise
     VERSION: #1 SMP Mon Feb 3 12:59:26 EST 2003
     MACHINE: i686  (2788 Mhz)
      MEMORY: 6 GB
       PANIC: "kernel BUG at pipe.c:120!"
         PID: 20571
     COMMAND: "imp"
        TASK: d1566000
         CPU: 1
       STATE: TASK_RUNNING (PANIC)

crash>

</pre>
</td>

</tr>
</table>
<p>
In this case the <tt>PANIC</tt> string <tt>"kernel BUG at pipe.c:120!"</tt>
points to the exact kernel
source code line at which the panic occurred.  
<p>
Then, getting a backtrace of panicking task is typically the first order
of the day:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>

crash> <b>bt</b>
PID: 20571  TASK: d1566000  CPU: 1   COMMAND: "imp"
 #0 [d1567e44] die at c010785c
 #1 [d1567e54] do_invalid_op at c0107b2c
 #2 [d1567f0c] error_code (via invalid_op) at c01073de
    EAX: 0000001d  EBX: ed87b2e0  ECX: c02f6064  EDX: 00005fa1  EBP: 00001000
    DS:  0018      ESI: f640e740  ES:  0018      EDI: 00001000
    CS:  0010      EIP: c0150b6d  ERR: ffffffff  EFLAGS: 00010292
 #3 [d1567f48] pipe_read at c0150b6d
 #4 [d1567f6c] sys_read at c01468d4
 #5 [d1567fc0] system_call at c01072dc
    EAX: 00000003  EBX: 0000000a  ECX: 40b4e05c  EDX: 00002000
    DS:  002b      ESI: 00002000  ES:  002b      EDI: 40b4e05c
    SS:  002b      ESP: bffe9e88  EBP: bffe9eb8
    CS:  0023      EIP: 40aaa1d4  ERR: 00000003  EFLAGS: 00000286
</pre>
</td>
</tr>
</table>
<p>
The backtrace shows that the call to <tt>die()</tt> was generated by 
an <tt>invalid_op</tt> exception.  The exception was caused by the
<tt>BUG()</tt> call in the <tt>pipe_read()</tt> function:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
        if (count && PIPE_WAITING_WRITERS(*inode) &&
                !(filp->f_flags & O_NONBLOCK)) {
                /*
                 * We know that we are going to sleep: signal
                 * writers synchronously that there is more
                 * room.
                 */
                wake_up_interruptible_sync(PIPE_WAIT(*inode));
                <b>if (!PIPE_EMPTY(*inode))
                        BUG();</b>
                goto do_more_read;
        }
</pre>

</td>
</tr>
</table>
<p>
In the code segment above, the <tt>pipe_read()</tt> code has
previously <tt>down</tt>'d the semaphore of the inode
associated with the pipe, giving it exclusive access.  It had read
all data in the pipe, but still needed more to satisfy the <tt>count</tt> 
requested.
Finding that there was a writer with more data -- and who was waiting 
on the semaphore -- it woke up the
writer.  
However, after doing
the wakeup, it did a sanity-check on the pipe contents, and found that it
was no longer empty -- which is theoretically <i>impossible</i> since
it was <i>still</i> holding the semaphore. 
It appeared that the writer process wrote to the pipe while the reader process
still had exclusive access -- somehow overriding the semaphore.

<p>
Since the semaphore mechanism was seemingly not working, it was first
necessary to look at the actual <tt>semaphore</tt> structure
associated with the pipe's inode.  This first required looking at
the first argument to the <tt>pipe_read()</tt> function; 
the <a href="help_pages/whatis.html"><tt>whatis</tt></a> command
shows that it is a <tt>struct file</tt> pointer:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>

<td>
<pre>
crash> <b>whatis pipe_read</b>
ssize_t pipe_read(<b>struct file *</b>, char *, size_t, loff_t *);
crash>
</pre>
</td>
</tr>
</table>
<p>
Using the <a href="help_pages/bt.html"><tt>bt -f</tt></a> option, each frame in the backtrace
is expanded to show all stack data in the frame.  Looking at the
expansion of the <tt>sys_read()</tt> frame, we can see that the
last thing pushed on the stack before calling <tt>pipe_read()</tt>

was the <tt>file</tt> pointer address of <tt>edf3f740</tt>:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
...
#3 [d1567f48] <b>pipe_read</b> at c0150b6d
    [RA: c01468d6  SP: d1567f4c  FP: d1567f6c  SIZE: 36]
    d1567f4c: c026701c  00000078  fffffff2  00001000
    d1567f5c: 00000000  edf3f740  ffffffea  00002000
    d1567f6c: c01468d6
 #4 [d1567f6c] <b>sys_read</b> at c01468d4
    [RA: c01072e3  SP: d1567f70  FP: d1567fc0  SIZE: 84]
    d1567f70: <b>edf3f740</b>  40b4f05c  00002000  edf3f760
    d1567f80: c03683d0  fffffffb  00000001  c0120d3b
    d1567f90: 00000046  00000046  0000000b  c0350960
    d1567fa0: 0000000b  f639eb00  c0108e0e  00000020
    d1567fb0: d1566000  00002000  40b4e05c  bffe9eb8
    d1567fc0: c01072e3
...</pre>

</td>
</tr>
</table>
<p>
The task at hand is finding the inode containing the suspect semaphore
from the <tt>file</tt> structure address.  
The <tt>file</tt> structure's <tt>f_dentry</tt> member 
points to its <tt>dentry</tt> structure,
whose <tt>d_inode</tt> member in turn points to the pipe's <tt>inode</tt>.
The <a href="help_pages/struct.html"><tt>struct</tt></a> command can be used 
to dump the complete contents
of a data structure at a given address; by tagging the <tt>.member</tt>

onto the structure name, we can print just the member desired.  
By following the structure chain, the inode address can be determined like so:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>struct file.f_dentry edf3f740</b>
  f_dentry = 0xdb0ec440,
crash> <b>struct dentry.d_inode db0ec440</b>
  d_inode = 0xf640e740,
crash> <b>struct inode.i_sem f640e740</b>

  i_sem = {
    count = {
      <b>counter = 2</b>
    },
    sleepers = 0,
    wait = {
      lock = {
        lock = 1
      },
      task_list = {
        next = 0xf640e7ac,
        prev = 0xf640e7ac
      }
    }
  },
crash>
</pre>
</td>
</tr>
</table>
<p>
The dump of the semaphore structure above showed the problem: the
<tt>counter</tt> value of <tt>2</tt> is illegal.  It should never
be greater than <tt>1</tt>; in this case a value of <tt>2</tt> 

allows <i>two</i> successful <tt>down</tt> operations, i.e.,
giving two tasks access to the pipe at the same time.
<p>
(As an aside, determining the inode address above could also be accomplished
by using the context-sensitive <a href="help_pages/files.html">
<tt>files</tt></a> command, which 
dumps the associated <tt>file</tt>, <tt>dentry</tt> and <tt>inode</tt> 

structure addresses for each open file descriptor of a task.  The dumped file
descriptor list would contain one with a reference to the <tt>file</tt>
structure at <tt>edf3f740</tt>, and would also
show the associated inode address of <tt>f640e740</tt>.)
<p>
Before getting a dumpfile, this same panic had occurred several times.
It was erroneously  presumed that the problem was
in the pipe-handling code, but it was eventually determined not to be
the case.  By instrumenting a kernel with debug code, 
the starting <tt>counter</tt> value of a pipe was found to 
be <tt>3</tt>.
Compounding that problem
was the fact that the inode slab cache is one of a few special cases
that presume that the freed inode's contents are left in a legitimate
state so that they do not have to be completely reinitialized with each
subsequent reallocation.  So when the pipe's inode was created, it received an
inode with a bogus counter value.
<p>
Confirming the existence of bogus inode structures in the
slab cache was a multi-stepped procedure.  Using the
command <a href="help_pages/kmem.html"><tt>kmem</tt></a>

command to access the inode slab cache, we can get the
addresses of all free and currently-allocated inodes.  
Since there are typically several thousand inodes, the output is
extremely verbose, but here is the beginning of it:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>kmem -S inode_cache</b>
CACHE    NAME                 OBJSIZE  ALLOCATED     TOTAL  SLABS  SSIZE
c7666564 inode_cache              448      11563     12339   1371     4k
SLAB      MEMORY    TOTAL  ALLOCATED  FREE
d1d82000  d1d82040      9          9     0
FREE / [ALLOCATED]
  [d1d82040]
  [d1d82200]
  [d1d823c0]
  [d1d82580]
  [d1d82740]
  [d1d82900]
  [d1d82ac0]
  [d1d82c80]
  [d1d82e40]
SLAB      MEMORY    TOTAL  ALLOCATED  FREE
f4e52000  f4e52040      9          7     2
FREE / [ALLOCATED]
   <b>f4e52040</b>  (cpu 1 cache)
   <b>f4e52200</b>  (cpu 1 cache)
  [f4e523c0]
  [f4e52580]
  [f4e52740]
  [f4e52900]
  [f4e52ac0]
  [f4e52c80]
  [f4e52e40]
...
</pre>

</td>
</tr>
</table>
<p>
In the truncated output above, <i>all</i> of the inode address in 
the slab cache are dumped; the ones currently in use are surrounded
by brackets, the free ones are <i>not</i>.
So, for example, the inodes at addresses <tt>f4e52040</tt> and 
<tt>f4e52200</tt> are free; the others are not.  The full output
was <a href="#REDIRECT_OUTPUT">piped to a script</a> that pulled out
just the free inode addresses (i.e., output lines starting with three spaces),
and <a href="#REDIRECT_OUTPUT">redirected them into a file</a>.  The 
file
was modified to be a <tt>crash</tt> 

<a href="#COMMAND_LINE_FROM_FILE">input file</a> by making each
extracted inode address to be the arguments of the 
<a href="help_pages/struct.html"><tt>struct</tt></a> command, using
its <a href="#SHORT_CUT">short-cut</a> method that allows the dropping of the <tt>struct</tt>
command name; therefore the input file contained hundreds of <tt>crash</tt> commands
of the form:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">

<tr>
<td>
<pre>
inode.i_sem f4e52040
inode.i_sem f4e52200
inode.i_sem f5cdc040
inode.i_sem f5cdc200
inode.i_sem f5cdc3c0
inode.i_sem f5cdc580
...
</pre>
</td>
</tr>
</table>
<p>
Note that the <a href="help_pages/struct.html"><tt>struct</tt></a>
command would be used by default above, as documented in its
help page; if the first command line argument
is not a <tt>crash</tt> or <tt>gdb</tt> command, but it

<i>is</i> the name of a known data structure, it passes the arguments
to the <a href="help_pages/struct.html"><tt>struct</tt></a> command.
<p>
Using the capability of feeding an 
<a href="#COMMAND_LINE_FROM_FILE">input file</a>, in this case 
consisting 
of hundreds of short-cut <a href="help_pages/struct.html"><tt>struct</tt></a> 
commands like those above, 
the output was again quite verbose, 
consisting of structure member dumps of the form:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>

<pre>
crash> <b>&lt; input.file</b>
crash> inode.i_sem f4e52040
  i_sem = {
    count = {
      counter = 1
    },
    sleepers = 0,
    wait = {
      lock = {
        lock = 1
      },
      task_list = {
        next = 0xf4e520ac,
        prev = 0xf4e520ac
      }
    }
  },
crash> inode.i_sem f4e52200
  i_sem = {
    count = {
      counter = 1
    },
    sleepers = 0,
    wait = {
      lock = {
        lock = 1
      },
      task_list = {
        next = 0xf4e5226c,
        prev = 0xf4e5226c
      }
    }
  },
...

</pre>
</td>
</tr>
</table>
<p>
However, it was a simple matter of 
<a href="#REDIRECT_OUTPUT">piping the output</a> to <tt>grep</tt>,
and looking for <tt>counter</tt> values not equal to <tt>1</tt>:

</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> < input.file | grep counter | grep -v "= 1"
      counter = 3
      counter = 3
      counter = 3
      counter = 3
crash> 
</pre>
</td>
</tr>
</table>
<p>
This turned out to be the smoking gun.  Another round of debugging with
an instrumented kernel that trapped attempts to free an inode with
a semaphore counter of <tt>3</tt> caught the perpetrator in the act.
<p><br></p>






<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="EXTENSIONS"></a> <hr> <p>




<p>
<h3>Command Extensions</h3>
<p>
Frequently users wish to add an additional option to an existing 
<tt>crash</tt> command, or add a brand new command, in order 
to address a kernel issue they are debugging or
developing.
For those reasons, the <tt>crash</tt> utility was designed with 
extensibility in mind. 
There are two ways to add new functionality:
<ol>

<li>
<a href=#ADDING_NEW_CODE>adding new code</a> and compiling it into the <tt>crash</tt>
executable, 
</li>
<li>
<a href=#SHARED_LIBRARY>creating a shared object</a> library that can be dynamically loaded by
using the <a href="help_pages/extend.html"><tt>extend</tt></a> command.
</li>
</ol>

<p>
This section consists of a quick guide that describes
how to get started using both methods.
</p>
<a name="ADDING_NEW_CODE"><hr></a>
<h4>Adding new code and compiling it into the <tt>crash</tt> executable</h4>
<p>
The current set of <tt>crash</tt> commands can be seen by entering
the <a href="help_pages/help.html"><tt>help</tt></a> command with no
arguments:

<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>help</b>

*              files          mod            runq           union
alias          foreach        mount          search         vm
ascii          fuser          net            set            vtop
bt             gdb            p              sig            waitq
btop           help           ps             struct         whatis
dev            irq            pte            swap           wr
dis            kmem           ptob           sym            q
eval           list           ptov           sys
exit           log            rd             task
extend         mach           repeat         timer

crash version: 4.0-8.11   gdb version: 6.1
For help on any command above, enter "help <command>".
For help on input options, enter "help input".
For help on output options, enter "help output".

crash> 
</pre>
</td>
</tr>
</table>
<p>
For each command in the menu above, there is an entry in a data structure
in the file <tt>global_data.c</tt>, which is located
in the top-level directory of the <tt>crash</tt> source code tree:

<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
/*
 *  To add a new command, declare it in defs.h and enter it in this table.
 */

struct command_table_entry base_command_table[] = {
	{"*", 	    cmd_pointer, help_pointer, 0},
	{"alias",   cmd_alias,   help_alias,   0},
        {"ascii",   cmd_ascii,   help_ascii,   0},
        {"bt",      cmd_bt,      help_bt,      REFRESH_TASK_TABLE},
	{"btop",    cmd_btop,    help_btop,    0},
	{"dev",     cmd_dev,     help_dev,     0},
	{"dis",     cmd_dis,     help_dis,     0},
	{"eval",    cmd_eval,    help_eval,    0},
	{"exit",    cmd_quit,    help_exit,    0},
	{"extend",  cmd_extend,  help_extend,  0},
	{"files",   cmd_files,   help_files,   REFRESH_TASK_TABLE},
	{"foreach", cmd_foreach, help_foreach, REFRESH_TASK_TABLE},
	{"fuser",   cmd_fuser,   help_fuser,   REFRESH_TASK_TABLE},
	{"gdb",     cmd_gdb,     help_gdb,     REFRESH_TASK_TABLE},
        {"help",    cmd_help,    help_help,    0},
	{"irq",     cmd_irq,     help_irq,     0},
	{"kmem",    cmd_kmem,    help_kmem,    0},
	{"list",    cmd_list,    help__list,   REFRESH_TASK_TABLE},
	{"log",     cmd_log,     help_log,     0},
	{"mach",    cmd_mach,    help_mach,    0},
	{"mod",     cmd_mod,     help_mod,     0},
	{"mount",   cmd_mount,   help_mount,   0},
	{"net",	    cmd_net,	 help_net,     REFRESH_TASK_TABLE},
	{"p",       cmd_p,       help_p,       0},
	{"ps",      cmd_ps,      help_ps,      REFRESH_TASK_TABLE},
	{"pte",     cmd_pte,     help_pte,     0},
	{"ptob",    cmd_ptob,    help_ptob,    0},
	{"ptov",    cmd_ptov,    help_ptov,    0},
        {"q",       cmd_quit,    help_quit,    0},
        {"rd",      cmd_rd,      help_rd,      0},
	{"repeat",  cmd_repeat,  help_repeat,  0},
	{"runq",    cmd_runq,    help_runq,    REFRESH_TASK_TABLE},
        {"search",  cmd_search,  help_search,  0},
        {"set",     cmd_set,     help_set,     REFRESH_TASK_TABLE},
        {"sig",     cmd_sig,     help_sig,     REFRESH_TASK_TABLE},
        {"struct",  cmd_struct,  help_struct,  0},
	{"swap",    cmd_swap,    help_swap,    0},
        {"sym",     cmd_sym,     help_sym,     0},
        {"sys",     cmd_sys,     help_sys,     REFRESH_TASK_TABLE},
        {"task",    cmd_task,    help_task,    REFRESH_TASK_TABLE},
	{"test",    cmd_test,    NULL,         HIDDEN_COMMAND},
        {"timer",   cmd_timer,   help_timer,   0},
	{"union",   cmd_union,   help_union,   0},
	{"vm",      cmd_vm,      help_vm,      REFRESH_TASK_TABLE},
	{"vtop",    cmd_vtop,    help_vtop,    REFRESH_TASK_TABLE},
	{"waitq",   cmd_waitq,   help_waitq,   REFRESH_TASK_TABLE},
	{"whatis",  cmd_whatis,  help_whatis,  0},
	{"wr",      cmd_wr,      help_wr,      0},
	{(char *)NULL}
};

</pre>
</td>
</tr>
</table>
<p>
Each entry consists of the following simple data structure:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>

struct command_table_entry {               /* one for each command in menu */
        char *name;
        cmd_func_t func;
        char **help_data;
        ulong flags;
};
</pre>
</td>
</tr>
</table>
<p>
The structure members consist of:
</p>
<blockquote>
<table border="2" cellpadding="10">
<tr>
<td><tt>name</tt></td>
<td>
The character string that appears in the help menu output.
It must be unique among other <tt>crash</tt> commands, and 
preferably should not clash with any <tt>gdb</tt> command.

</td>
</tr>
<tr>
<td><tt>func</tt></td>
<td>
A pointer to the function that performs the command.
To add an option to an existing command, find the file
that contains this function, and modify it as desired.
</td>
</tr>
<tr>
<td><tt>help_data</tt></td>
<td>A pointer to an array of character strings that make up the
help data for that command.  Although optional, it's certainly useful
to create help data for any new commands or options.
</tr>
<tr>
<td><tt>flags</tt></td>

<td>If <tt>REFRESH_TASK_TABLE</tt>, the set of running tasks on a live
system will be updated just prior to executing the command.
<br>
If <tt>HIDDEN_COMMAND</tt>, the command will not be shown in the
help menu.  The only command with this flag is the
<tt>test</tt> command, whose function <tt>cmd_test()</tt>
exists solely as an builtin aid for quickly developing new or
temporary commands.
</td>
</tr>
</table>
</blockquote>

<p>
For a newly-written command to appear in the help menu, it simply requires
a reference to it in the structure above.  To test a new command without 
adding it to the menu, use the hidden "test"
command, found in <tt>test.c</tt>:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
void
cmd_test(void)
{
        int c;

        while ((c = getopt(argcnt, args, "")) != EOF) {
                switch(c)
                {
                default:
                        argerrs++;
                        break;
                }
        }

        if (argerrs)
                cmd_usage(pc->curcmd, SYNOPSIS);

        while (args[optind]) {
                ;
                optind++;
        }
} 
</pre>
</td>
</tr>
</table>
<p>
The <tt>test</tt> command contains the basic template used by 

<tt>crash</tt> commands to accept dash-arguments, which are fielded
by the <tt>getopt()</tt> routine, while all other command line arguments are
fielded in the <tt>while</tt> loop.  
To add an option to the <tt>test</tt> command (or any other existing command), 
simply fit it into the appropriate argument-gathering mechanism. 
Or, for that matter, if no arguments are required, put the functionality
at the end of the command's function.  
Here is a trivial example of a change
to the <tt>cmd_test()</tt> function, with the modifications highlighted:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">

<tr>
<td>
<pre>
void
cmd_test(void)
{
        int c;

        while ((c = getopt(argcnt, args, <b>"xa:"</b>)) != EOF) {
                switch(c)
                {
                <b>case 'x':
                        fprintf(fp, "arg: -x\n");
                        break;
                case 'a':
                        fprintf(fp, "arg: -a %s\n", optarg);
                        break;</b>
                default:
                        argerrs++;
                        break;
                }
        }

        if (argerrs)
                cmd_usage(pc->curcmd, SYNOPSIS);

        while (args[optind]) {
                <b>fprintf(fp, "arg: %s\n", args[optind]);</b>
                ;
                optind++;
        }

        <b>fprintf(fp, "do test work here...\n");</b>
}

</pre>
</td>
</tr>
</table>
<p>
Then re-compile <tt>crash</tt> by entering <tt>make</tt>:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# <b>make</b>

TARGET: X86
 CRASH: 4.0-8.11
   GDB: 6.1

cc -c -g -DX86 -D_FILE_OFFSET_BITS=64 build_data.c  
<b>cc -c -g -DX86 -D_FILE_OFFSET_BITS=64 test.c</b>
ar -rs crashlib.a main.o tools.o global_data.o memory.o filesys.o help.o task.o 
build_data.o kernel.o test.o gdb_interface.o net.o dev.o alpha.o x86.o ppc.o ia6
4.o s390.o s390x.o s390dbf.o ppc64.o x86_64.o extensions.o remote.o va_server.o 
va_server_v1.o symbols.o cmdline.o lkcd_common.o lkcd_v1.o lkcd_v2_v3.o lkcd_v5.
o lkcd_v7.o lkcd_v8.o lkcd_fix_mem.o s390_dump.o netdump.o diskdump.o xendump.o 
lkcd_x86_trace.o unwind_v1.o unwind_v2.o unwind_v3.o unwind_x86_32_64.o xen_hype
r.o xen_hyper_command.o xen_hyper_global_data.o xen_hyper_dump_tables.o
gcc -g -O2       \
                -o `cat mergeobj` libgdb.a \
                   ../bfd/libbfd.a ../readline/libreadline.a ../opcodes/libopcod
es.a  ../libiberty/libiberty.a     -lm -lncurses  ../libiberty/libiberty.a  -ldl
 -rdynamic `cat mergelibs`
#
</pre>
</td>
</tr>
</table>
<p>
Then run the <tt>test</tt> command with the tree possible argument types:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>

<pre>
crash> <b>test -x -a dasharg this that the other</b>
arg: -x
arg: -a dasharg
arg: this
arg: that
arg: the
arg: other
do test work here...
crash>
</pre>
</td>
</tr>
</table>
<p>
The easiest way to implement a new
command's functionality is to use an existing command as a template.
There is a broad range of utility routines that handle 
argument strings, read memory, access data structures and their members, 
display data, and so on, that obviate the need to reinvent the wheel
to accomplish a task.  Look at what other similar commands do, and
copy their mechanisms.
</p>
<a name="SHARED_LIBRARY"><hr></a>
<h4>Creating a shared object library and loading it with <a href="help_pages/extend.html"><tt>extend</tt></a></h4>

While adding a new command and/or command option in the manner above
is useful, it would require the same integration mechanism with each
subsequent release of the <tt>crash</tt> utility. Since that could become 
tedious, another extension mechanism exists in which share objects containing
one or more <tt>crash</tt> commands can be written, and then dynamically 
attached 
to a running <tt>crash</tt> session, using the 
<a href="help_pages/extend.html"><tt>extend</tt></a> command.
Once loaded, the command(s) in the shared object library automatically
appear in the help menu, as if they were compiled into the
<tt>crash</tt> executable.  As an quick aid in creating a shared object, 
the help page for the <a href="help_pages/extend.html"><tt>extend</tt></a>

contains an example C program tagged onto the end, which adds a new
<tt>echo</tt> command (which simply echoes back all arguments).  
The C program piece can be cut and pasted into a file,
say <tt>echo.c</tt> for example, and then compiled like so:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# gcc -nostartfiles -shared -rdynamic -o echo.so echo.c -fPIC -D&lt;machine-type&gt; $(TARGET_CFLAGS)
</pre>

</td>
</tr>
</table>
<p>
where &lt;<tt>machine-type</tt>&gt; is the appropriate architecture
<tt>X86, X86_64, IA64, PPC64, S390</tt> or <tt>S390X</tt>),
and where <tt>$(TARGET_CFLAGS)</tt> is <tt>-D_FILE_OFFSET_BITS=64</tt> on 32-bit architectures, 
and  <tt>-m64</tt> on ppc64.
So for an x86 build, the compile line
would be:

<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
# gcc -nostartfiles -shared -rdynamic -o echo.so echo.c -fPIC -DX86 -D_FILE_OFFSET_BITS=64
</pre>
</td>
</tr>
</table>
<p>
The resultant <tt>echo.so</tt> file may be dynamically linked into 
<tt>crash</tt> during runtime using the 

<a href="help_pages/extend.html"><tt>extend</tt></a> command:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>extend echo.so</b>
./echo.so: shared object loaded
crash>
</pre>
</td>
</tr>
</table>
<p>

Or, to automatically load the shared library
during <tt>crash</tt> session initialization, put the following string
into a <tt>.crashrc</tt> file
located in the current directory, or in the user's <tt>$HOME</tt> directory:
<p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
extend echo.so
</pre>

</td>
</tr>
</table>
<p>
Here is the help menu once the library is loaded; note the 
integration of the new <tt>echo</tt> command:
</p>
<table border="0" bgcolor="#E0E0E0" width="100%">
<tr>
<td>
<pre>
crash> <b>help</b>

*              extend         mach           repeat         timer
alias          files          mod            runq           union
ascii          foreach        mount          search         vm
bt             fuser          net            set            vtop
btop           gdb            p              sig            waitq
dev            help           ps             struct         whatis
dis            irq            pte            swap           wr
<b>echo</b>           kmem           ptob           sym            q
eval           list           ptov           sys
exit           log            rd             task

crash version: 4.0-8.11   gdb version: 6.1
For help on any command above, enter "help <command>".
For help on input options, enter "help input".
For help on output options, enter "help output".
</pre>
</td>
</tr>
</table>
<p>
With this extension mechanism, the most that would be required to use
the shared library with subsequent versions of <tt>crash</tt> would be
a simple re-compile of the <tt>echo.c</tt> file. 
<p><br></p>








<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<a name="GFDL"></a> <hr> <p>



<pre>


                GNU Free Documentation License
                  Version 1.2, November 2002


 Copyright (C) 2000,2001,2002  Free Software Foundation, Inc.
     51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.


0. PREAMBLE

The purpose of this License is to make a manual, textbook, or other
functional and useful document "free" in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.

This License is a kind of "copyleft", which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.

We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.


1. APPLICABILITY AND DEFINITIONS

This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The "Document", below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as "you".  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.

A "Modified Version" of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.

A "Secondary Section" is a named appendix or a front-matter section of
the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document's overall subject
(or to related matters) and contains nothing that could fall directly
within that overall subject.  (Thus, if the Document is in part a
textbook of mathematics, a Secondary Section may not explain any
mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.

The "Invariant Sections" are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.

The "Cover Texts" are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.

A "Transparent" copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent.
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not "Transparent" is called "Opaque".

Examples of suitable formats for Transparent copies include plain
ASCII without markup, Texinfo input format, LaTeX input format, SGML
or XML using a publicly available DTD, and standard-conforming simple
HTML, PostScript or PDF designed for human modification.  Examples of
transparent image formats include PNG, XCF and JPG.  Opaque formats
include proprietary formats that can be read and edited only by
proprietary word processors, SGML or XML for which the DTD and/or
processing tools are not generally available, and the
machine-generated HTML, PostScript or PDF produced by some word
processors for output purposes only.

The "Title Page" means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, "Title Page" means
the text near the most prominent appearance of the work's title,
preceding the beginning of the body of the text.

A section "Entitled XYZ" means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as "Acknowledgements",
"Dedications", "Endorsements", or "History".)  To "Preserve the Title"
of such a section when you modify the Document means that it remains a
section "Entitled XYZ" according to this definition.

The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.


2. VERBATIM COPYING

You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.

You may also lend copies, under the same conditions stated above, and
you may publicly display copies.


3. COPYING IN QUANTITY

If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document's license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.

If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.

If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material.
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.

It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.


4. MODIFICATIONS

You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:

A. Use in the Title Page (and on the covers, if any) a title distinct
   from that of the Document, and from those of previous versions
   (which should, if there were any, be listed in the History section
   of the Document).  You may use the same title as a previous version
   if the original publisher of that version gives permission.
B. List on the Title Page, as authors, one or more persons or entities
   responsible for authorship of the modifications in the Modified
   Version, together with at least five of the principal authors of the
   Document (all of its principal authors, if it has fewer than five),
   unless they release you from this requirement.
C. State on the Title page the name of the publisher of the
   Modified Version, as the publisher.
D. Preserve all the copyright notices of the Document.
E. Add an appropriate copyright notice for your modifications
   adjacent to the other copyright notices.
F. Include, immediately after the copyright notices, a license notice
   giving the public permission to use the Modified Version under the
   terms of this License, in the form shown in the Addendum below.
G. Preserve in that license notice the full lists of Invariant Sections
   and required Cover Texts given in the Document's license notice.
H. Include an unaltered copy of this License.
I. Preserve the section Entitled "History", Preserve its Title, and add
   to it an item stating at least the title, year, new authors, and
   publisher of the Modified Version as given on the Title Page.  If
   there is no section Entitled "History" in the Document, create one
   stating the title, year, authors, and publisher of the Document as
   given on its Title Page, then add an item describing the Modified
   Version as stated in the previous sentence.
J. Preserve the network location, if any, given in the Document for
   public access to a Transparent copy of the Document, and likewise
   the network locations given in the Document for previous versions
   it was based on.  These may be placed in the "History" section.
   You may omit a network location for a work that was published at
   least four years before the Document itself, or if the original
   publisher of the version it refers to gives permission.
K. For any section Entitled "Acknowledgements" or "Dedications",
   Preserve the Title of the section, and preserve in the section all
   the substance and tone of each of the contributor acknowledgements
   and/or dedications given therein.
L. Preserve all the Invariant Sections of the Document,
   unaltered in their text and in their titles.  Section numbers
   or the equivalent are not considered part of the section titles.
M. Delete any section Entitled "Endorsements".  Such a section
   may not be included in the Modified Version.
N. Do not retitle any existing section to be Entitled "Endorsements"
   or to conflict in title with any Invariant Section.
O. Preserve any Warranty Disclaimers.

If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version's license notice.
These titles must be distinct from any other section titles.

You may add a section Entitled "Endorsements", provided it contains
nothing but endorsements of your Modified Version by various
parties--for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.

You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.

The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.


5. COMBINING DOCUMENTS

You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.

The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.

In the combination, you must combine any sections Entitled "History"
in the various original documents, forming one section Entitled
"History"; likewise combine any sections Entitled "Acknowledgements",
and any sections Entitled "Dedications".  You must delete all sections
Entitled "Endorsements".


6. COLLECTIONS OF DOCUMENTS

You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.

You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.


7. AGGREGATION WITH INDEPENDENT WORKS

A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an "aggregate" if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation's users beyond what the individual works permit.
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.

If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document's Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form.
Otherwise they must appear on printed covers that bracket the whole
aggregate.


8. TRANSLATION

Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.

If a section in the Document is Entitled "Acknowledgements",
"Dedications", or "History", the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.


9. TERMINATION

You may not copy, modify, sublicense, or distribute the Document except
as expressly provided for under this License.  Any other attempt to
copy, modify, sublicense or distribute the Document is void, and will
automatically terminate your rights under this License.  However,
parties who have received copies, or rights, from you under this
License will not have their licenses terminated so long as such
parties remain in full compliance.


10. FUTURE REVISIONS OF THIS LICENSE

The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
http://www.gnu.org/copyleft/.

Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License "or any later version" applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.
</pre>




</table>
</body>
</html>

